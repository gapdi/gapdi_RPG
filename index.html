<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VILLAIN HUNTER : Hall of Fame</title>
    <style>
        :root {
            --bg-color: #000; --panel-bg: #111; --text-main: #fff;
            --common: #ffffff; --rare: #ffff00; --epic: #bf00ff;
            --danger: #ff4444; --border: #333; --gold: #ffd700;
        }
        body { background: var(--bg-color); color: var(--text-main); font-family: 'Pretendard', sans-serif; display: flex; justify-content: center; padding: 20px; margin: 0; }
        #game-container { width: 100%; max-width: 420px; background: var(--panel-bg); border-radius: 16px; padding: 25px; border: 1px solid var(--border); position: relative; }
        
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 2px solid var(--border); padding-bottom: 10px; }
        .panel { background: rgba(255,255,255,0.05); border-radius: 12px; padding: 15px; margin-bottom: 15px; border: 1px solid rgba(255,255,255,0.1); }
        
        .color-common { color: var(--common); }
        .color-rare { color: var(--rare); font-weight: bold; }
        .color-epic { color: var(--epic); font-weight: bold; text-shadow: 0 0 5px rgba(191,0,255,0.3); }
        .color-gold { color: var(--gold); font-weight: 900; }
        
        .hp-bar-bg { width: 100%; height: 12px; background: #222; margin: 8px 0; border-radius: 6px; overflow: hidden; border: 1px solid #333; }
        .hp-fill { height: 100%; transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        
        button { background: #fff; color: #000; border: none; padding: 12px; cursor: pointer; font-weight: 900; border-radius: 8px; }
        button:disabled { background: #222; color: #555; }
        
        #log-window { height: 110px; overflow-y: auto; font-size: 13px; color: #999; display: flex; flex-direction: column-reverse; gap: 6px; padding: 12px; background: rgba(0,0,0,0.4); border-radius: 8px; border: 1px solid #222; }
        
        /* ëª¨ë‹¬ ë ˆì´ì–´ */
        .modal { display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 100; padding: 30px; box-sizing: border-box; background: rgba(0,0,0,0.98); flex-direction: column; align-items: center; justify-content: center; text-align: center; border-radius: 16px; }
        
        #ranking-list { width: 100%; max-height: 250px; overflow-y: auto; margin-top: 15px; border-top: 1px solid #333; }
        .rank-item { display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid #222; font-size: 14px; }
        
        input { background: #222; border: 1px solid #444; color: #fff; padding: 10px; border-radius: 8px; width: 80%; text-align: center; margin-bottom: 15px; }
    </style>
</head>
<body>

<div id="game-container">
    <div id="game-over" class="modal">
        <h1 style="color:var(--danger)">DEFEATED</h1>
        <p style="color:#888;">ëŠ¥ë ¥ì¹˜ì™€ ì•„ì´í…œì„ ëª¨ë‘ ìƒì—ˆìŠµë‹ˆë‹¤.</p>
        <button onclick="revive()">ë¬´ì¼í‘¼ ë¶€í™œ</button>
    </div>

    <div id="ending-ui" class="modal">
        <h1 class="color-epic">NIRVANA</h1>
        <p>30ì¢…ì˜ ë¹ŒëŸ°ì„ í•´íƒˆì‹œí‚¨ ë‹¹ì‹ !<br>ëª…ì˜ˆì˜ ì „ë‹¹ì— ì´ë¦„ì„ ë‚¨ê¸°ì„¸ìš”.</p>
        <div style="font-size: 20px; margin: 15px 0;" class="color-gold">ìµœì¢… ê³¨ë“œ: <span id="final-gold">0</span>G</div>
        <input type="text" id="player-name-input" placeholder="ì‚¬ëƒ¥ê¾¼ ì´ë¦„ ì…ë ¥" maxlength="8">
        <button onclick="submitRanking()" style="width: 85%;">ë­í‚¹ ë“±ë¡ ë° í™˜ìƒ</button>
    </div>

    <div id="book-ui" class="modal">
        <div style="display:flex; width:100%; justify-content: space-around; margin-bottom: 15px;">
            <button onclick="showSection('book')" id="tab-book" style="background:#444; color:#fff; flex:1; border-radius:8px 0 0 8px;">ë„ê°</button>
            <button onclick="showSection('rank')" id="tab-rank" style="background:#222; color:#aaa; flex:1; border-radius:0 8px 8px 0;">ë­í‚¹</button>
        </div>
        <div id="book-section" style="width:100%; height:300px; overflow-y:auto; text-align:left;"></div>
        <div id="rank-section" style="width:100%; height:300px; overflow-y:auto; display:none;">
            <div id="ranking-list"></div>
        </div>
        <button onclick="toggleBook()" style="width:100%; margin-top:15px;">ë‹«ê¸°</button>
    </div>

    <div class="header">
        <strong style="letter-spacing:1px;">VILLAIN HUNTER</strong>
        <button onclick="toggleBook()" style="font-size:11px; padding: 6px 12px;">ğŸ† ë„ê°/ë­í‚¹</button>
    </div>
    
    <div class="panel">
        <div style="display:flex; justify-content:space-between; font-weight:900; margin-bottom:5px;">
            <span id="atk-display">ATK 10</span>
            <span>HP <span id="p-hp">100</span> / <span id="p-max">100</span></span>
        </div>
        <div class="hp-bar-bg"><div id="p-hp-bar" class="hp-fill" style="background:#fff"></div></div>
        <button id="heal-btn" onclick="usePotion()">ğŸ• ì ì‹¬ ì‹ì‚¬ <span id="heal-count">(0)</span></button>
        <div style="font-size:11px; color:#aaa; display:flex; justify-content:space-between; margin-top:5px;">
            <span>GOLD: <span id="gold" class="color-gold">0</span></span>
            <span>LV: <span id="lv-display">1</span></span>
            <span>REBIRTH: <span id="re-count" class="color-epic">0</span></span>
        </div>
    </div>

    <div class="panel">
        <div id="m-name" style="font-weight:900; font-size:16px; margin-bottom:5px;">Target</div>
        <div class="hp-bar-bg"><div id="m-hp-bar" class="hp-fill" style="background:var(--danger)"></div></div>
        <div id="m-hp-text" style="text-align:right; font-size:12px; font-weight:bold;">0 / 0</div>
    </div>

    <div class="panel">
        <div style="font-size:11px; margin-bottom:10px; color:#888; font-weight:bold;">WORKSHOP</div>
        <div style="display:grid; grid-template-columns:1fr 1fr 1fr; gap:8px;">
            <button class="color-common" id="btn1" onclick="craft('íš¨ìì†', 10, 20, 'ëˆ…ëˆ…í•œ íŠ€ê¹€ì˜·', 3)" style="font-size:10px; height:60px;">íš¨ìì†</button>
            <button class="color-rare" id="btn2" onclick="craft('í¸ì§€', 50, 100, 'ì‚¬ì§ì„œ', 1)" style="font-size:10px; height:60px;">í¸ì§€</button>
            <button class="color-epic" id="btn3" onclick="craft('ì†”', 150, 300, 'ì•”ëª¨ë‹ˆì•„', 1)" style="font-size:10px; height:60px;">ì†”</button>
        </div>
        <div id="inv" style="font-size:11px; margin-top:12px; color:#aaa;">ì†Œì¬ê°€ ì—†ìŠµë‹ˆë‹¤.</div>
    </div>

    <div id="log-window"></div>
</div>

<script>
    const MONSTERS = {
        normal: [
            { name: "ì¶œê·¼ ëŒ€ë¦¬ë‹˜", hp: 60, atk: 5, drop: "ëˆ…ëˆ…í•œ íŠ€ê¹€ì˜·", gold: 20 },
            { name: "ë²•ì¹´ ë¶€ì¥ë‹˜", hp: 70, atk: 7, drop: "ëˆ…ëˆ…í•œ íŠ€ê¹€ì˜·", gold: 25 },
            { name: "ë¼ë–¼ ì°¨ì¥ë‹˜", hp: 80, atk: 10, drop: "ëˆ…ëˆ…í•œ íŠ€ê¹€ì˜·", gold: 30 },
            { name: "ê²°ì •ì¥ì•  ì‚¬ì›", hp: 50, atk: 4, drop: "ëˆ…ëˆ…í•œ íŠ€ê¹€ì˜·", gold: 15 },
            { name: "ë°ì´í„° ì—†ëŠ” í°", hp: 45, atk: 6, drop: "ëˆ…ëˆ…í•œ íŠ€ê¹€ì˜·", gold: 20 },
            { name: "í‡´ê·¼ì§ì „ íŒ€ì¥ë‹˜", hp: 130, atk: 25, drop: "ì‚¬ì§ì„œ", gold: 60 },
            { name: "ìƒˆë¼ë°œê°€ë½ ì°§ìŒ", hp: 220, atk: 65, drop: "ì•”ëª¨ë‹ˆì•„", gold: 110 },
            { name: "ì¼ìš”ì¼ ë°¤ ìš°ìš¸", hp: 150, atk: 30, drop: "ì‚¬ì§ì„œ", gold: 70 },
            { name: "ë‹«íˆëŠ” ì§€í•˜ì² ë¬¸", hp: 140, atk: 35, drop: "ëˆ…ëˆ…í•œ íŠ€ê¹€ì˜·", gold: 60 },
            { name: "í’ˆì ˆëœ í•œì •íŒ", hp: 190, atk: 45, drop: "ì‚¬ì§ì„œ", gold: 85 },
            { name: "ì½ì”¹í•˜ëŠ” ìƒëŒ€", hp: 90, atk: 15, drop: "ëˆ…ëˆ…í•œ íŠ€ê¹€ì˜·", gold: 35 },
            { name: "ëˆ…ëˆ…í•œ ì¹˜í‚¨", hp: 55, atk: 5, drop: "ëˆ…ëˆ…í•œ íŠ€ê¹€ì˜·", gold: 18 },
            { name: "ìŠ¤í¬ì¼ëŸ¬ ë¹ŒëŸ°", hp: 110, atk: 25, drop: "ì‚¬ì§ì„œ", gold: 50 },
            { name: "ë§Œì› ë²„ìŠ¤ ë°±íŒ©", hp: 125, atk: 18, drop: "ëˆ…ëˆ…í•œ íŠ€ê¹€ì˜·", gold: 45 },
            { name: "ì•ˆí„°ì§€ëŠ” WIFI", hp: 75, atk: 10, drop: "ëˆ…ëˆ…í•œ íŠ€ê¹€ì˜·", gold: 25 },
            { name: "í‹€ë¦° ë¹„ë²ˆ 5íšŒ", hp: 140, atk: 35, drop: "ì‚¬ì§ì„œ", gold: 70 },
            { name: "ì¶©ì „ê¸° ê³ ì¥", hp: 90, atk: 20, drop: "ëˆ…ëˆ…í•œ íŠ€ê¹€ì˜·", gold: 35 },
            { name: "ì¸µê°„ì†ŒìŒ ë§ì¹˜", hp: 170, atk: 40, drop: "ì•”ëª¨ë‹ˆì•„", gold: 85 },
            { name: "ë¹„ì˜¤ëŠ” í° ìš´ë™í™”", hp: 115, atk: 22, drop: "ëˆ…ëˆ…í•œ íŠ€ê¹€ì˜·", gold: 50 },
            { name: "ì´ì–´í° í•œìª½ ê³ ì¥", hp: 100, atk: 18, drop: "ëˆ…ëˆ…í•œ íŠ€ê¹€ì˜·", gold: 40 },
            { name: "í”„ë¦¬ë¯¸ì—„ ë§Œë£Œ", hp: 110, atk: 20, drop: "ëˆ…ëˆ…í•œ íŠ€ê¹€ì˜·", gold: 45 },
            { name: "ê²¨ìš¸ì²  ì •ì „ê¸°", hp: 75, atk: 45, drop: "ëˆ…ëˆ…í•œ íŠ€ê¹€ì˜·", gold: 35 },
            { name: "íƒë°° ì˜¤ë°°ì†¡", hp: 155, atk: 28, drop: "ì‚¬ì§ì„œ", gold: 80 },
            { name: "ì¹´ê³µì¡±ì˜ ëˆˆì´", hp: 130, atk: 22, drop: "ëˆ…ëˆ…í•œ íŠ€ê¹€ì˜·", gold: 55 },
            { name: "í™”ì¥ì‹¤ íœ´ì§€ì—†ìŒ", hp: 190, atk: 50, drop: "ì•”ëª¨ë‹ˆì•„", gold: 100 }
        ],
        rare: [
            { name: "ğŸ‘‘ ì›”ìš”ì¼ 8:59AM", hp: 1100, atk: 90, drop: "ì‚¬ì§ì„œ", gold: 500 },
            { name: "ğŸ‘‘ 3ë…„ ì•ˆë¹¤ ì–‘ë§", hp: 900, atk: 100, drop: "ì•”ëª¨ë‹ˆì•„", gold: 450 },
            { name: "ğŸ‘‘ ìœˆë„ìš° ì—…ë°ì´íŠ¸", hp: 1300, atk: 80, drop: "ì‚¬ì§ì„œ", gold: 600 },
            { name: "ğŸ‘‘ ëª…ì ˆ ì”ì†Œë¦¬", hp: 1600, atk: 70, drop: "ì‚¬ì§ì„œ", gold: 700 },
            { name: "ğŸ‘‘ ìë‹ˆ? ì „ì• ì¸", hp: 1200, atk: 110, drop: "ì•”ëª¨ë‹ˆì•„", gold: 550 }
        ]
    };

    let player, monster;
    const initialStats = { lv:1, atk:10, hp:100, maxHp:100, gold:0, inv:{}, book:{}, rebirthCount:0, potion:1, totalKills:0 };

    function initGame() {
        const saved = localStorage.getItem('villain_halloffame_v12');
        player = saved ? JSON.parse(saved) : JSON.parse(JSON.stringify(initialStats));
        player.isDead = false;
        spawn();
    }

    function spawn() {
        let pool = (player.totalKills < 15) ? MONSTERS.normal.slice(0, 10) : MONSTERS.normal;
        const isRare = (Math.random() < 0.15 && player.totalKills > 20);
        let d = isRare ? MONSTERS.rare[Math.floor(Math.random()*MONSTERS.rare.length)] : pool[Math.floor(Math.random()*pool.length)];
        let growth = 1 + (player.lv * 0.06); 
        monster = { 
            name: d.name,
            max: Math.floor((d.hp + (player.lv * 12)) * growth),
            hp: Math.floor((d.hp + (player.lv * 12)) * growth),
            atk: Math.floor((d.atk + (player.lv * 3)) * growth),
            gold: d.gold, drop: d.drop, isBoss: isRare
        };
        updateUI();
    }

    function battle() {
        if(player.isDead) return;
        monster.hp -= player.atk;
        if(monster.hp > 0) player.hp -= monster.atk;
        if(player.hp <= 0) { player.hp = 0; gameOver(); }
        else if(monster.hp <= 0) win();
        updateUI();
    }

    function win() {
        player.gold += monster.gold;
        player.totalKills++;
        player.book[monster.name] = (player.book[monster.name] || 0) + 1;
        player.hp = Math.min(player.maxHp, player.hp + Math.floor(player.maxHp * 0.15));
        if(Math.random() < 0.35) player.potion++;
        if(Math.random() < 0.45) player.inv[monster.drop] = (player.inv[monster.drop] || 0) + 1;
        
        if(Object.keys(player.book).length >= 30) {
            player.isDead = true;
            document.getElementById('final-gold').innerText = player.gold;
            document.getElementById('ending-ui').style.display = 'flex';
        } else {
            player.lv++; spawn(); save();
        }
    }

    function submitRanking() {
        const name = document.getElementById('player-name-input').value.trim() || "ìµëª…ì˜ í—Œí„°";
        let ranks = JSON.parse(localStorage.getItem('villain_ranks') || "[]");
        ranks.push({ name: name, gold: player.gold, rebirth: player.rebirthCount });
        ranks.sort((a, b) => b.gold - a.gold);
        ranks = ranks.slice(0, 10); // ìƒìœ„ 10ëª…ë§Œ ì €ì¥
        localStorage.setItem('villain_ranks', JSON.stringify(ranks));
        
        // í™˜ìƒ ì²˜ë¦¬
        rebirth();
        document.getElementById('ending-ui').style.display = 'none';
        document.getElementById('player-name-input').value = "";
    }

    function showSection(type) {
        document.getElementById('book-section').style.display = type === 'book' ? 'block' : 'none';
        document.getElementById('rank-section').style.display = type === 'rank' ? 'block' : 'none';
        document.getElementById('tab-book').style.background = type === 'book' ? '#444' : '#222';
        document.getElementById('tab-rank').style.background = type === 'rank' ? '#444' : '#222';
        if(type === 'rank') renderRanking();
        else renderBook();
    }

    function renderRanking() {
        const list = document.getElementById('ranking-list');
        const ranks = JSON.parse(localStorage.getItem('villain_ranks') || "[]");
        list.innerHTML = ranks.length ? "" : "<p style='color:#666; margin-top:20px;'>ì•„ì§ ë“±ë¡ëœ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>";
        ranks.forEach((r, i) => {
            list.innerHTML += `
                <div class="rank-item">
                    <span>${i+1}. <b class="color-rare">${r.name}</b> <small>(R${r.rebirth})</small></span>
                    <span class="color-gold">${r.gold.toLocaleString()}G</span>
                </div>`;
        });
    }

    function renderBook() {
        const list = document.getElementById('book-section');
        list.innerHTML = "";
        const all = [...MONSTERS.normal, ...MONSTERS.rare];
        all.forEach(m => {
            const s = player.book[m.name] || 0;
            list.innerHTML += `<div style="padding:8px; border-bottom:1px solid #222; display:flex; justify-content:space-between; color:${s>0?'#fff':'#444'}">
                <span class="${s>0 && (m.name.includes('ğŸ‘‘')?'color-epic':'')}">${s>0?m.name:'???'}</span>
                <span>${s}íšŒ ë°•ì‚´</span>
            </div>`;
        });
    }

    // --- ê¸°ë³¸ ê¸°ëŠ¥ ìœ ì§€ ---
    function usePotion() {
        if(player.potion > 0 && !player.isDead) {
            player.potion--;
            player.hp = Math.min(player.maxHp, player.hp + Math.floor(player.maxHp * 0.8));
            addLog(`ğŸ• <span style="color:#0f0">HP 80% íšŒë³µ!</span>`);
            updateUI();
        }
    }
    function craft(n, atkP, hpP, mat, cost) {
        if((player.inv[mat]||0) >= cost) {
            player.inv[mat] -= cost; player.atk += atkP; player.maxHp += hpP; player.hp = player.maxHp;
            addLog(`ğŸ›  <span class="color-rare">${n}</span> ì¥ì°©!`); updateUI(); save();
        }
    }
    function gameOver() { player.isDead = true; player.potion = 0; document.getElementById('game-over').style.display = 'flex'; }
    function revive() {
        const b = player.book, r = player.rebirthCount;
        player = JSON.parse(JSON.stringify(initialStats));
        player.book = b; player.rebirthCount = r;
        player.atk += (r * 150); player.maxHp += (r * 300); player.hp = player.maxHp;
        document.getElementById('game-over').style.display = 'none';
        spawn(); save(); addLog(`<span style="color:var(--danger)">ğŸ’€ ì´ˆê¸°í™” í›„ ë¶€í™œ!</span>`);
    }
    function rebirth() {
        player.rebirthCount++;
        const b = player.book, r = player.rebirthCount;
        player = JSON.parse(JSON.stringify(initialStats));
        player.book = b; player.rebirthCount = r;
        player.atk += (r * 150); player.maxHp += (r * 300); player.hp = player.maxHp;
        spawn(); save();
    }
    function save() { localStorage.setItem('villain_halloffame_v12', JSON.stringify(player)); }
    function toggleBook() { 
        const ui = document.getElementById('book-ui');
        ui.style.display = (ui.style.display === 'flex') ? 'none' : 'flex';
        if(ui.style.display === 'flex') showSection('book');
    }
    function addLog(m) {
        const l = document.getElementById('log-window');
        l.innerHTML = `<div>> ${m}</div>` + l.innerHTML;
        if(l.childNodes.length > 15) l.removeChild(l.lastChild);
    }
    function updateUI() {
        document.getElementById('p-hp').innerText = Math.floor(player.hp);
        document.getElementById('p-max').innerText = player.maxHp;
        document.getElementById('p-hp-bar').style.width = (player.hp/player.maxHp*100) + "%";
        document.getElementById('m-hp-bar').style.width = (monster.hp/monster.max*100) + "%";
        document.getElementById('m-hp-text').innerText = `${Math.max(0, monster.hp)} / ${monster.max}`;
        document.getElementById('atk-display').innerText = `ATK ${player.atk}`;
        document.getElementById('gold').innerText = player.gold.toLocaleString();
        document.getElementById('lv-display').innerText = player.lv;
        document.getElementById('re-count').innerText = player.rebirthCount;
        document.getElementById('heal-count').innerText = `(${player.potion})`;
        const mEl = document.getElementById('m-name');
        mEl.innerText = monster.name; mEl.className = monster.isBoss ? 'color-epic' : 'color-common';
        document.getElementById('book-count-header').innerText = Object.keys(player.book).length;
        document.getElementById('heal-btn').disabled = (player.potion <= 0 || player.isDead);
        let invH = "";
        if(player.inv['ëˆ…ëˆ…í•œ íŠ€ê¹€ì˜·']) invH += `<span class="color-common">íŠ€ê¹€ì˜·(${player.inv['ëˆ…ëˆ…í•œ íŠ€ê¹€ì˜·']})</span> `;
        if(player.inv['ì‚¬ì§ì„œ']) invH += `<span class="color-rare">ì‚¬ì§ì„œ(${player.inv['ì‚¬ì§ì„œ']})</span> `;
        if(player.inv['ì•”ëª¨ë‹ˆì•„']) invH += `<span class="color-epic">ì•”ëª¨ë‹ˆì•„(${player.inv['ì•”ëª¨ë‹ˆì•„']})</span> `;
        document.getElementById('inv').innerHTML = invH || "ì†Œì¬ê°€ ì—†ìŠµë‹ˆë‹¤.";
        document.getElementById('btn1').disabled = (player.inv['ëˆ…ëˆ…í•œ íŠ€ê¹€ì˜·'] || 0) < 3;
        document.getElementById('btn2').disabled = (player.inv['ì‚¬ì§ì„œ'] || 0) < 1;
        document.getElementById('btn3').disabled = (player.inv['ì•”ëª¨ë‹ˆì•„'] || 0) < 1;
    }

    window.onload = () => { initGame(); setInterval(battle, 1000); };
</script>
</body>
</html>