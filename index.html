<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë³‘ë§› ë¹ŒëŸ° ì‚¬ëƒ¥í„° : í•´íƒˆ ì—ë””ì…˜</title>
    <style>
        body { background: #1a1a1a; color: #00ff41; font-family: 'Courier New', monospace; display: flex; justify-content: center; padding: 20px; overflow-x: hidden; }
        #game-container { width: 100%; max-width: 500px; border: 3px double #00ff41; padding: 20px; background: #000; position: relative; }
        .panel { border: 1px solid #333; padding: 10px; margin-bottom: 10px; }
        .title { color: #ffff00; font-weight: bold; border-bottom: 1px solid #333; display: block; margin-bottom: 5px; }
        #log-window { height: 150px; overflow-y: auto; font-size: 13px; color: #aaa; border-top: 1px solid #333; padding-top: 5px; display: flex; flex-direction: column-reverse; }
        button { background: #00ff41; color: #000; border: none; padding: 8px; cursor: pointer; font-weight: bold; margin: 2px; }
        button:disabled { background: #114411; color: #004411; }
        
        /* UI ìš”ì†Œ */
        .hp-bar-bg { width: 100%; height: 12px; background: #333; margin: 5px 0; }
        .hp-fill { height: 100%; background: #ff3e3e; transition: width 0.3s; }
        .p-hp-fill { background: #00ff41; }

        /* íŒì—… UI */
        #book-ui, #ending-ui { display: none; position: absolute; top: 10px; left: 10px; right: 10px; bottom: 10px; z-index: 200; padding: 20px; border: 2px solid #00ff41; overflow-y: auto; }
        #book-ui { background: rgba(0,20,0,0.95); }
        
        /* í•´íƒˆ ì—”ë”© ë ˆì´ì–´ */
        #ending-ui { background: #fff; color: #000; border-color: #ffd700; text-align: center; display: none; }
        #ending-ui h1 { font-size: 3rem; margin-top: 50px; }

        #game-over { display: none; position: absolute; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.9); color: red; text-align: center; padding-top: 120px; z-index: 100; }
        .collected { color: #ffff00; }
        .unknown { color: #444; }
    </style>
</head>
<body>

<div id="game-container">
    <div id="game-over">
        <h1>ì¸ìƒ í•˜ì§</h1>
        <button onclick="revive()" style="background: red; color: white;">ì •ì‹  ì°¨ë¦¬ê¸° (ìì¡´ì‹¬ 20% ì°¨ê°)</button>
    </div>

    <div id="book-ui">
        <h3 style="color: #ffff00; text-align: center;">ğŸ“• ë¹ŒëŸ° ë„ê° (<span id="book-count">0</span>/30)</h3>
        <div id="book-list"></div>
        <button onclick="toggleBook()" style="width: 100%; margin-top: 10px;">ì†ì„¸ë¡œ ëŒì•„ê°€ê¸°</button>
    </div>

    <div id="ending-ui">
        <h1>[ è§£è„« ]</h1>
        <p style="font-size: 1.2rem; font-weight: bold;">ëª¨ë“  ë²ˆë‡Œ(ë¹ŒëŸ°)ë¥¼ ë©¸í•˜ì˜€ìŠµë‹ˆë‹¤.</p>
        <p>ë‹¹ì‹ ì€ ì´ì œ ì¶œê·¼ë„, ì‚¬ì§ì„œë„, ëˆ…ëˆ…í•œ ì¹˜í‚¨ë„ ì—†ëŠ”<br>ì§„ì •í•œ í‰í™”ì˜ ê²½ì§€ì— ë„ë‹¬í–ˆìŠµë‹ˆë‹¤.</p>
        <div style="margin: 30px 0; font-size: 0.9rem;">(ëª¨ë“  ë°ì´í„°ê°€ ì´ˆê¸°í™”ë˜ë©° ë³´ë„ˆìŠ¤ ëŠ¥ë ¥ì¹˜ë¥¼ ì–»ìŠµë‹ˆë‹¤)</div>
        <button onclick="rebirth()" style="background: #000; color: #ffd700; padding: 15px; font-size: 1.1rem;">í™˜ìƒí•˜ì—¬ ë‹¤ì‹œ ì‹œì‘í•˜ê¸°</button>
    </div>

    <h2 style="text-align: center; color: #ffff00;">ğŸ¤ª ë³‘ë§› ë¹ŒëŸ° ì‚¬ëƒ¥í„° ğŸ¤ª</h2>
    
    <div class="panel">
        <span class="title">[ ë‚´ ìƒíƒœ ]</span>
        <p>ì •ì‹ ë ¥: <span id="p-hp">100</span>/<span id="p-max">100</span> | ì „íˆ¬ë ¥: <span id="atk">10</span></p>
        <div class="hp-bar-bg"><div id="p-hp-bar" class="hp-fill p-hp-fill"></div></div>
        <p>ìì¡´ì‹¬: <span id="gold">0</span>G | í™˜ìƒ: <span id="re-count">0</span>íšŒ <button onclick="toggleBook()" style="font-size: 10px; padding: 3px;">ğŸ“• ë„ê°ë³´ê¸°</button></p>
    </div>

    <div class="panel">
        <span class="title">[ ì˜¤ëŠ˜ì˜ ë¹ŒëŸ° ]</span>
        <p id="m-name">ëŒ€ìƒ: íƒìƒ‰ ì¤‘...</p>
        <p>ë©˜íƒˆ: <span id="m-hp">0</span>/<span id="m-max">0</span></p>
        <div class="hp-bar-bg"><div id="m-hp-bar" class="hp-fill"></div></div>
    </div>

    <div class="panel">
        <span class="title">[ ê°€ê³µì†Œ ]</span>
        <button id="btn1" onclick="craft('íš¨ìì†', 12, 'ëˆ…ëˆ…í•œ íŠ€ê¹€ì˜·', 3)">íš¨ìì†(íŠ€ê¹€ì˜·3)</button>
        <button id="btn2" onclick="craft('ì „ì—¬ì¹œ í¸ì§€', 50, 'ì‚¬ì§ì„œ', 1)">í¸ì§€(ì‚¬ì§ì„œ1)</button>
        <button id="btn3" onclick="craft('í™”ì¥ì‹¤ ì†”', 120, 'ì•”ëª¨ë‹ˆì•„', 1)">ì†”(ì•”ëª¨ë‹ˆì•„1)</button>
    </div>

    <div id="log-window"></div>
</div>

<script>
    const MONSTERS = {
        normal: [
            { name: "ì¶œê·¼í•˜ê¸° ì‹«ì€ ëŒ€ë¦¬ë‹˜", hp: 60, atk: 5, drop: "ëˆ…ëˆ…í•œ íŠ€ê¹€ì˜·", gold: 20 },
            { name: "ë²•ì¸ì¹´ë“œ ì•ˆ ì£¼ëŠ” ë¶€ì¥ë‹˜", hp: 70, atk: 7, drop: "ëˆ…ëˆ…í•œ íŠ€ê¹€ì˜·", gold: 25 },
            { name: "ë§ ëë§ˆë‹¤ 'ë¼ë–¼ëŠ”' í•˜ëŠ” ì°¨ì¥ë‹˜", hp: 80, atk: 10, drop: "ëˆ…ëˆ…í•œ íŠ€ê¹€ì˜·", gold: 30 },
            { name: "ì ì‹¬ ë©”ë‰´ ê²°ì • ëª» í•˜ëŠ” ì‚¬ì›", hp: 50, atk: 4, drop: "ëˆ…ëˆ…í•œ íŠ€ê¹€ì˜·", gold: 15 },
            { name: "í‡´ê·¼ ì§ì „ì— ì¼ ì£¼ëŠ” íŒ€ì¥ë‹˜", hp: 100, atk: 15, drop: "ì‚¬ì§ì„œ", gold: 50 },
            { name: "ë°ì´í„° ì—†ëŠ” ìŠ¤ë§ˆíŠ¸í°", hp: 40, atk: 6, drop: "ëˆ…ëˆ…í•œ íŠ€ê¹€ì˜·", gold: 20 },
            { name: "ì½ê³  ë‹µì¥ ì—†ëŠ” ì¹´í†¡ë°©", hp: 90, atk: 12, drop: "ëˆ…ëˆ…í•œ íŠ€ê¹€ì˜·", gold: 35 },
            { name: "ì–´ì œ ë¨¹ë‹¤ ë‚¨ì€ ëˆ…ëˆ…í•œ ì¹˜í‚¨", hp: 45, atk: 5, drop: "ëˆ…ëˆ…í•œ íŠ€ê¹€ì˜·", gold: 15 },
            { name: "ë¬¸ì§€ë°©ì— ì°§ì€ ìƒˆë¼ë°œê°€ë½", hp: 200, atk: 80, drop: "ì•”ëª¨ë‹ˆì•„", gold: 100 },
            { name: "ì•ˆê²½ ì¼ëŠ”ë° ì•ˆê²½ ì°¾ëŠ” ë‚˜", hp: 75, atk: 5, drop: "ëˆ…ëˆ…í•œ íŠ€ê¹€ì˜·", gold: 25 },
            { name: "ì–‘ë§ ì‹ ê³  ë“¤ì–´ê°„ í™”ì¥ì‹¤", hp: 150, atk: 30, drop: "ì•”ëª¨ë‹ˆì•„", gold: 70 },
            { name: "ì”ì•¡ ë¶€ì¡± ëœ¬ ë²„ìŠ¤ ì¹´ë“œ", hp: 110, atk: 22, drop: "ëˆ…ëˆ…í•œ íŠ€ê¹€ì˜·", gold: 50 },
            { name: "ì¼ìš”ì¼ ë°¤ 11ì‹œì˜ ìš°ìš¸í•¨", hp: 140, atk: 15, drop: "ì‚¬ì§ì„œ", gold: 65 },
            { name: "ë¹„ë°€ë²ˆí˜¸ 5ë²ˆ í‹€ë¦° ê³µì¸ì¸ì¦ì„œ", hp: 120, atk: 20, drop: "ì‚¬ì§ì„œ", gold: 60 },
            { name: "ì”¨ ë§ì€ ìˆ˜ë°•", hp: 65, atk: 7, drop: "ëˆ…ëˆ…í•œ íŠ€ê¹€ì˜·", gold: 24 },
            { name: "ì•ˆ í„°ì§€ëŠ” ì™€ì´íŒŒì´", hp: 80, atk: 10, drop: "ëˆ…ëˆ…í•œ íŠ€ê¹€ì˜·", gold: 25 },
            { name: "ëª¨ë¥´ëŠ” ë²ˆí˜¸ ì „í™”", hp: 50, atk: 5, drop: "ëˆ…ëˆ…í•œ íŠ€ê¹€ì˜·", gold: 10 },
            { name: "ë²„ìŠ¤ ë°˜ëŒ€ë¡œ íƒ", hp: 100, atk: 10, drop: "ëˆ…ëˆ…í•œ íŠ€ê¹€ì˜·", gold: 40 },
            { name: "ëˆ…ëˆ…í•œ íŒì½˜", hp: 40, atk: 3, drop: "ëˆ…ëˆ…í•œ íŠ€ê¹€ì˜·", gold: 12 },
            { name: "ìê¸° í•  ë§ë§Œ í•˜ëŠ” AI", hp: 90, atk: 15, drop: "ëˆ…ëˆ…í•œ íŠ€ê¹€ì˜·", gold: 35 },
            { name: "ì‚¬ë¼ì§„ ë¦¬ëª¨ì»¨", hp: 110, atk: 20, drop: "ëˆ…ëˆ…í•œ íŠ€ê¹€ì˜·", gold: 45 },
            { name: "ë¬´í•œ ë¡œë”© ìœ íŠœë¸Œ", hp: 85, atk: 12, drop: "ëˆ…ëˆ…í•œ íŠ€ê¹€ì˜·", gold: 30 },
            { name: "ì°¨ê°€ìš´ ë¶•ì–´ë¹µ", hp: 50, atk: 6, drop: "ëˆ…ëˆ…í•œ íŠ€ê¹€ì˜·", gold: 18 },
            { name: "ì§€í•˜ì²  ë¬¸ ë°”ë¡œ ì•ì—ì„œ ë‹«í˜", hp: 130, atk: 25, drop: "ëˆ…ëˆ…í•œ íŠ€ê¹€ì˜·", gold: 55 },
            { name: "ë‚´ ì•ì—ì„œ ëŠê¸´ í•œì •íŒ", hp: 160, atk: 40, drop: "ì‚¬ì§ì„œ", gold: 80 }
        ],
        rare: [
            { name: "ğŸ‘‘ ì›”ìš”ì¼ ì•„ì¹¨ 8ì‹œ 59ë¶„", hp: 800, atk: 60, drop: "ì‚¬ì§ì„œ", gold: 500 },
            { name: "ğŸ‘‘ 3ë…„ ì•ˆ ë¹¤ ìì·¨ë°© ì–‘ë§", hp: 600, atk: 70, drop: "ì•”ëª¨ë‹ˆì•„", gold: 400 },
            { name: "ğŸ‘‘ ìœˆë„ìš° ê°•ì œ ì—…ë°ì´íŠ¸", hp: 1000, atk: 55, drop: "ì‚¬ì§ì„œ", gold: 600 },
            { name: "ğŸ‘‘ ëª…ì ˆ ì”ì†Œë¦¬ í­ê²©ê¸°", hp: 1200, atk: 45, drop: "ì‚¬ì§ì„œ", gold: 700 },
            { name: "ğŸ‘‘ ì „ì• ì¸ì˜ 'ìë‹ˆ?' ë¬¸ì", hp: 900, atk: 80, drop: "ì•”ëª¨ë‹ˆì•„", gold: 550 }
        ]
    };

    let player = { lv: 1, atk: 10, hp: 100, maxHp: 100, gold: 0, inv: {}, isDead: false, book: {}, rebirthCount: 0 };
    let monster = { name: "", hp: 0, max: 0, atk: 0, drop: "", gold: 0 };

    function battle() {
        if (player.isDead) return;
        monster.hp -= player.atk;
        player.hp -= monster.atk;
        if (player.hp <= 0) { gameOver(); } 
        else if (monster.hp <= 0) { win(); }
        updateUI();
    }

    function win() {
        player.gold += monster.gold;
        player.book[monster.name] = (player.book[monster.name] || 0) + 1;
        
        // ì²´ë ¥ íšŒë³µ
        player.hp = Math.min(player.maxHp, player.hp + Math.floor(player.maxHp * 0.5));
        
        // ì—”ë”© ì²´í¬
        const collectedCount = Object.keys(player.book).length;
        if (collectedCount >= 30) {
            showEnding();
            return;
        }

        player.lv++;
        spawn();
        save();
    }

    function showEnding() {
        document.getElementById('ending-ui').style.display = 'block';
        player.isDead = true; // ê²Œì„ ì¼ì‹œì •ì§€ íš¨ê³¼
    }

    function rebirth() {
        // í™˜ìƒ ë³´ë„ˆìŠ¤: ê³µê²©ë ¥ ê¸°ë³¸ê°’ ìƒìŠ¹
        const newRebirthCount = (player.rebirthCount || 0) + 1;
        const bonusAtk = 10 + (newRebirthCount * 50);
        
        player = {
            lv: 1,
            atk: bonusAtk,
            hp: 150,
            maxHp: 150,
            gold: 0,
            inv: {},
            isDead: false,
            book: {}, // ë„ê°ë„ ì´ˆê¸°í™”í•˜ê±°ë‚˜ ìœ ì§€ ì„ íƒ ê°€ëŠ¥ (ì—¬ê¸°ì„  ì´ˆê¸°í™”)
            rebirthCount: newRebirthCount
        };
        
        document.getElementById('ending-ui').style.display = 'none';
        addLog(`<span style="color:#ffd700;">âœ¨ ì œ ${newRebirthCount}ì˜ ì‚¶ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤. ê¸°ë³¸ ê³µê²©ë ¥ì´ ëŒ€í­ ìƒìŠ¹í–ˆìŠµë‹ˆë‹¤!</span>`);
        spawn();
        save();
        updateUI();
    }

    function spawn() {
        const isRare = Math.random() < 0.15;
        let data = isRare ? MONSTERS.rare[Math.floor(Math.random()*MONSTERS.rare.length)] 
                          : MONSTERS.normal[Math.floor(Math.random()*MONSTERS.normal.length)];
        monster = { name: data.name, max: data.hp+(player.lv*5), hp: data.hp+(player.lv*5), atk: data.atk+(player.lv), drop: data.drop, gold: data.gold };
        updateUI();
    }

    function toggleBook() {
        const ui = document.getElementById('book-ui');
        ui.style.display = (ui.style.display === 'block') ? 'none' : 'block';
        if(ui.style.display === 'block') renderBook();
    }

    function renderBook() {
        const list = document.getElementById('book-list');
        list.innerHTML = "";
        let count = 0;
        const all = [...MONSTERS.normal, ...MONSTERS.rare];
        all.forEach(m => {
            const seen = player.book[m.name] || 0;
            if(seen > 0) count++;
            list.innerHTML += `<div class="book-item ${seen > 0 ? 'collected' : 'unknown'}">
                ${seen > 0 ? m.name : '???'} - ${seen}íšŒ
            </div>`;
        });
        document.getElementById('book-count').innerText = count;
    }

    function save() { localStorage.setItem('funny_hunter_v4', JSON.stringify(player)); }
    function load() {
        const s = localStorage.getItem('funny_hunter_v4');
        if(s) { 
            player = JSON.parse(s); 
            if(player.hp <= 0) player.hp = player.maxHp; 
            player.isDead = false; 
        }
        spawn();
    }

    function gameOver() { player.isDead = true; player.hp = 0; document.getElementById('game-over').style.display = 'block'; }
    function revive() { player.isDead = false; player.hp = player.maxHp; player.gold = Math.floor(player.gold*0.8); document.getElementById('game-over').style.display = 'none'; spawn(); updateUI(); }
    
    function craft(n, p, m, c) {
        if((player.inv[m]||0)>=c) { 
            player.inv[m]-=c; player.atk+=p; player.maxHp+=30; player.hp=player.maxHp; 
            addLog(`ğŸ› ï¸ [${n}] ì¥ì°©! (ì „íˆ¬ë ¥+${p})`); updateUI(); save(); 
        }
    }

    function updateUI() {
        document.getElementById('p-hp').innerText = player.hp;
        document.getElementById('p-max').innerText = player.maxHp;
        document.getElementById('p-hp-bar').style.width = (player.hp/player.maxHp*100) + "%";
        document.getElementById('m-hp').innerText = Math.max(0, monster.hp);
        document.getElementById('m-max').innerText = monster.max;
        document.getElementById('m-hp-bar').style.width = (monster.hp/monster.max*100) + "%";
        document.getElementById('atk').innerText = player.atk;
        document.getElementById('gold').innerText = player.gold;
        document.getElementById('re-count').innerText = player.rebirthCount || 0;
        document.getElementById('m-name').innerText = `ëŒ€ìƒ: ${monster.name}`;
        let invS = "ì£¼ë¨¸ë‹ˆ: ";
        for(let k in player.inv) if(player.inv[k]>0) invS += `${k}(${player.inv[k]}) `;
        document.getElementById('inv').innerText = invS;
        document.getElementById('btn1').disabled = (player.inv['ëˆ…ëˆ…í•œ íŠ€ê¹€ì˜·'] || 0) < 3;
        document.getElementById('btn2').disabled = (player.inv['ì‚¬ì§ì„œ'] || 0) < 1;
        document.getElementById('btn3').disabled = (player.inv['ì•”ëª¨ë‹ˆì•„'] || 0) < 1;
    }

    function addLog(m) {
        const l = document.getElementById('log-window');
        l.innerHTML = `<div>> ${m}</div>` + l.innerHTML;
        if (l.childNodes.length > 30) l.removeChild(l.lastChild);
    }

    window.onload = () => { load(); updateUI(); setInterval(battle, 1000); };
</script>
</body>
</html>