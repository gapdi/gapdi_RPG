<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë³‘ë§› í—Œí„° IDLE</title>
    <style>
        /* ë³‘ë§› ê°ì„± í„°ë¯¸ë„ ë””ìì¸ */
        body { background: #1a1a1a; color: #00ff41; font-family: 'Courier New', monospace; display: flex; justify-content: center; padding: 20px; line-height: 1.5; }
        #game-container { width: 100%; max-width: 500px; border: 3px double #00ff41; padding: 20px; background: #000; position: relative; }
        .panel { border: 1px solid #333; padding: 10px; margin-bottom: 10px; }
        .title { color: #ffff00; font-weight: bold; border-bottom: 1px solid #333; display: block; margin-bottom: 5px; }
        #log-window { height: 180px; overflow-y: auto; font-size: 13px; color: #aaa; border-top: 1px solid #333; padding-top: 5px; display: flex; flex-direction: column-reverse; }
        button { background: #00ff41; color: #000; border: none; padding: 8px; cursor: pointer; font-weight: bold; margin: 2px; font-family: inherit; }
        button:disabled { background: #114411; color: #004411; cursor: not-allowed; }
        
        /* HP ë°” ìŠ¤íƒ€ì¼ */
        .hp-bar-bg { width: 100%; height: 12px; background: #333; margin: 5px 0; border: 1px solid #555; }
        .hp-fill { height: 100%; background: #ff3e3e; transition: width 0.3s; }
        .p-hp-fill { background: #00ff41; }

        /* ê²Œì„ì˜¤ë²„ ë ˆì´ì–´ */
        #game-over { display: none; position: absolute; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.9); color: #ff0000; text-align: center; padding-top: 120px; z-index: 100; }
        .rare-msg { color: #ff00ff; font-weight: bold; background: #fff; }
    </style>
</head>
<body>

<div id="game-container">
    <div id="game-over">
        <h1 style="font-size: 3rem;">ì¸ìƒ í•˜ì§</h1>
        <p>í˜„ì‹¤ì˜ ë²½ì— ë¶€ë”ªí˜€ ì •ì‹ ì„ ìƒì—ˆìŠµë‹ˆë‹¤.</p>
        <button onclick="revive()" style="background: #ff0000; color: #fff; padding: 15px;">ì •ì‹  ì°¨ë¦¬ê¸° (ìì¡´ì‹¬ 20% ì°¨ê°)</button>
    </div>

    <h2 style="text-align: center; color: #ffff00;">ğŸ¤ª ë³‘ë§› í—Œí„° IDLE ğŸ¤ª</h2>
    
    <div class="panel">
        <span class="title">[ ë‚´ ìƒíƒœ ]</span>
        <p>ì •ì‹ ë ¥(HP): <span id="p-hp">100</span> / <span id="p-max">100</span></p>
        <div class="hp-bar-bg"><div id="p-hp-bar" class="hp-fill p-hp-fill" style="width: 100%;"></div></div>
        <p>ì „íˆ¬ë ¥: <span id="atk">10</span> | ìì¡´ì‹¬(GOLD): <span id="gold">0</span>G</p>
        <p id="inv" style="font-size: 12px; color: #00acee;">ì£¼ë¨¸ë‹ˆ: í…… ë¹„ì—ˆìŒ</p>
    </div>

    <div class="panel">
        <span class="title">[ ì˜¤ëŠ˜ì˜ ë¹ŒëŸ° ]</span>
        <p id="m-name">ëŒ€ìƒ: ëŒ€ê¸° ì¤‘...</p>
        <p>ë©˜íƒˆ(HP): <span id="m-hp">0</span> / <span id="m-max">0</span></p>
        <div class="hp-bar-bg"><div id="m-hp-bar" class="hp-fill" style="width: 0%;"></div></div>
    </div>

    <div class="panel">
        <span class="title">[ ì“°ë ˆê¸° ì¬í™œìš© ì„¼í„° ]</span>
        <button id="btn1" onclick="craft('íš¨ìì†', 12, 'ëˆ…ëˆ…í•œ íŠ€ê¹€ì˜·', 3)">íš¨ìì†(íŠ€ê¹€ì˜·3)</button>
        <button id="btn2" onclick="craft('ì „ì—¬ì¹œ í¸ì§€', 50, 'ì‚¬ì§ì„œ', 1)">í¸ì§€(ì‚¬ì§ì„œ1)</button>
        <button id="btn3" onclick="craft('í™”ì¥ì‹¤ ì†”', 120, 'ì•”ëª¨ë‹ˆì•„', 1)">ì†”(ì•”ëª¨ë‹ˆì•„1)</button>
    </div>

    <div id="log-window"></div>
</div>

<script>
    // 1. ë°ì´í„° ë² ì´ìŠ¤
    const MONSTERS = {
        normal: [
            { name: "ì¶œê·¼í•˜ê¸° ì‹«ì€ ëŒ€ë¦¬ë‹˜", hp: 60, atk: 5, drop: "ëˆ…ëˆ…í•œ íŠ€ê¹€ì˜·", gold: 20 },
            { name: "ë°ì´í„° ì—†ëŠ” ìŠ¤ë§ˆíŠ¸í°", hp: 80, atk: 8, drop: "ëˆ…ëˆ…í•œ íŠ€ê¹€ì˜·", gold: 25 },
            { name: "ì–´ì œ ë¨¹ë‹¤ ë‚¨ì€ ì¹˜í‚¨", hp: 50, atk: 4, drop: "ëˆ…ëˆ…í•œ íŠ€ê¹€ì˜·", gold: 15 }
        ],
        rare: [
            { name: "ğŸ‘‘ ì›”ìš”ì¼ ì•„ì¹¨ 8ì‹œ 59ë¶„", hp: 500, atk: 40, drop: "ì‚¬ì§ì„œ", gold: 200 },
            { name: "ğŸ‘‘ 3ë…„ ì•ˆ ë¹¤ ì–‘ë§", hp: 400, atk: 50, drop: "ì•”ëª¨ë‹ˆì•„", gold: 150 }
        ]
    };

    let player = { lv: 1, atk: 10, hp: 100, maxHp: 100, gold: 0, inv: {}, isDead: false };
    let monster = { name: "", hp: 0, max: 0, atk: 0, drop: "", gold: 0 };

    // 2. í•µì‹¬ ë¡œì§
    function battle() {
        if (player.isDead) return;

        // ì„œë¡œ í•œ ëŒ€ì”© ì£¼ê³ ë°›ê¸°
        monster.hp -= player.atk;
        player.hp -= monster.atk;

        if (player.hp <= 0) {
            player.hp = 0;
            player.isDead = true;
            document.getElementById('game-over').style.display = 'block';
            addLog("<span style='color:red;'>ğŸ’€ ë©˜íƒˆì´ ë°”ì‚¬ì‚­ ë˜ì—ˆìŠµë‹ˆë‹¤...</span>");
        } else if (monster.hp <= 0) {
            win();
        }
        updateUI();
    }

	function win() {
		player.gold += monster.gold;
		
		// --- ì²´ë ¥ 50% íšŒë³µ ë¡œì§ ì¶”ê°€ ---
		const recoveryAmount = Math.floor(player.maxHp * 0.5); // ìµœëŒ€ ì²´ë ¥ì˜ 50% ê³„ì‚°
		player.hp += recoveryAmount;
		
		// ìµœëŒ€ ì²´ë ¥ì„ ì´ˆê³¼í•˜ì§€ ì•Šë„ë¡ ë³´ì •
		if (player.hp > player.maxHp) {
			player.hp = player.maxHp;
		}
		addLog(`ğŸ’– ìŠ¹ë¦¬ ë³´ë„ˆìŠ¤! ì •ì‹ ë ¥ì´ ${recoveryAmount}ë§Œí¼ íšŒë³µë˜ì—ˆìŠµë‹ˆë‹¤.`);
		// ----------------------------

		let dMsg = "";
		if (Math.random() > 0.4) {
			player.inv[monster.drop] = (player.inv[monster.drop] || 0) + 1;
			dMsg = ` [${monster.drop} íšë“!]`;
		}
		addLog(`âœ… ${monster.name} ì²˜ì¹˜! +${monster.gold}G${dMsg}`);
		player.lv++;
		spawn();
		save();
	}

    function spawn() {
        const isRare = Math.random() < 0.15;
        let data = isRare ? MONSTERS.rare[Math.floor(Math.random()*MONSTERS.rare.length)] 
                          : MONSTERS.normal[Math.floor(Math.random()*MONSTERS.normal.length)];
        
        monster = {
            name: data.name,
            max: data.hp + (player.lv * 5),
            hp: data.hp + (player.lv * 5),
            atk: data.atk + Math.floor(player.lv * 0.8),
            drop: data.drop,
            gold: data.gold
        };

        if(isRare) addLog(`<span class="rare-msg">ğŸ˜± [ìœ„í—˜] ${monster.name}ì´(ê°€) ë‚˜íƒ€ë‚¬ë‹¤!</span>`);
        else addLog(`> [${monster.name}]ì´(ê°€) ì‹œë¹„ë¥¼ ê²ë‹ˆë‹¤.`);
    }

    function revive() {
        player.isDead = false;
        player.hp = player.maxHp;
        player.gold = Math.floor(player.gold * 0.8);
        document.getElementById('game-over').style.display = 'none';
        addLog("ğŸ©¹ ê²¨ìš° ì •ì‹ ì„ ì°¨ë¦¬ê³  ë‹¤ì‹œ ì „ì¥ìœ¼ë¡œ ë‚˜ê°‘ë‹ˆë‹¤.");
        spawn();
        updateUI();
    }

    function craft(name, pwr, mat, count) {
        if ((player.inv[mat] || 0) >= count) {
            player.inv[mat] -= count;
            player.atk += pwr;
            player.maxHp += 30;
            player.hp = player.maxHp;
            addLog(`ğŸ› ï¸ [${name}] ì¥ì°©! ì „íˆ¬ë ¥ +${pwr}, ì •ì‹ ë ¥ +30`);
            updateUI();
            save();
        }
    }

    // 3. ìœ í‹¸ë¦¬í‹° (UI, ì €ì¥)
    function save() { localStorage.setItem('funny_hunter_save', JSON.stringify({player, monster})); }
    function load() {
        const s = localStorage.getItem('funny_hunter_save');
        if(s) {
            const d = JSON.parse(s);
            player = d.player;
            monster = d.monster;
            if(player.hp <= 0) player.hp = player.maxHp;
        } else {
            spawn();
        }
    }

    function updateUI() {
        document.getElementById('p-hp').innerText = player.hp;
        document.getElementById('p-max').innerText = player.maxHp;
        document.getElementById('p-hp-bar').style.width = (player.hp/player.maxHp*100) + "%";
        document.getElementById('m-hp').innerText = Math.max(0, monster.hp);
        document.getElementById('m-max').innerText = monster.max;
        document.getElementById('m-hp-bar').style.width = (monster.hp/monster.max*100) + "%";
        document.getElementById('atk').innerText = player.atk;
        document.getElementById('gold').innerText = player.gold;
        document.getElementById('m-name').innerText = `ëŒ€ìƒ: ${monster.name}`;

        let invS = "ì£¼ë¨¸ë‹ˆ: ";
        for(let k in player.inv) if(player.inv[k]>0) invS += `${k}(${player.inv[k]}ê°œ) `;
        document.getElementById('inv').innerText = invS;

        document.getElementById('btn1').disabled = (player.inv['ëˆ…ëˆ…í•œ íŠ€ê¹€ì˜·'] || 0) < 3;
        document.getElementById('btn2').disabled = (player.inv['ì‚¬ì§ì„œ'] || 0) < 1;
        document.getElementById('btn3').disabled = (player.inv['ì•”ëª¨ë‹ˆì•„'] || 0) < 1;
    }

    function addLog(m) {
        const l = document.getElementById('log-window');
        const d = document.createElement('div');
        d.innerHTML = `> ${m}`;
        l.appendChild(d);
        if (l.childNodes.length > 50) l.removeChild(l.firstChild);
    }

    window.onload = () => { load(); updateUI(); setInterval(battle, 1000); };
</script>
</body>
</html>