<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>VILLAIN HUNTER : NOIR</title>
    <style>
        :root {
            --bg: #000000;
            --surface: #111111;
            --border: #333333;
            --text-main: #ffffff;
            --text-sub: #666666;
            --rare-color: #bbbbbb; /* 레어: 밝은 회색 + 밑줄 */
            --unique-color: #ffffff; /* 유니크: 순백색 + 굵게 */
        }

        body { 
            background: var(--bg); color: var(--text-main); 
            font-family: 'Inter', sans-serif; 
            display: flex; justify-content: center; padding: 40px 20px; margin: 0; 
        }

        #game-container { width: 440px; background: var(--surface); border: 1px solid var(--border); padding: 30px; position: relative; }

        header { border-bottom: 1px solid var(--border); padding-bottom: 20px; margin-bottom: 20px; }
        .status-row { display: flex; justify-content: space-between; align-items: baseline; }
        .stage-title { font-size: 11px; text-transform: uppercase; color: var(--text-sub); letter-spacing: 2px; }
        .collection-count { font-size: 24px; font-weight: 200; }

        .progress-bar { width: 100%; height: 1px; background: #222; margin-top: 10px; }
        #progress-fill { height: 100%; background: #fff; width: 0%; transition: width 0.4s; }

        /* 장비 슬롯 등급별 스타일 */
        .equip-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1px; background: var(--border); border: 1px solid var(--border); margin: 20px 0; }
        .slot { background: var(--surface); height: 60px; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 5px; }
        .slot span { font-size: 9px; color: var(--text-sub); margin-bottom: 4px; }
        .slot .name { font-size: 10px; text-align: center; color: var(--text-sub); transition: 0.3s; }

        /* 등급별 텍스트 스타일 */
        .grade-common { color: #666 !important; }
        .grade-rare { color: #eee !important; font-weight: 600; text-decoration: underline; text-underline-offset: 3px; }
        .grade-unique { color: #ffffff !important; font-weight: 900; text-shadow: 0 0 8px rgba(255,255,255,0.5); }

        .target-card { border: 1px solid var(--border); padding: 40px 20px; text-align: center; margin-bottom: 20px; transition: 0.3s; }
        #m-name { font-size: 22px; font-weight: 600; margin-bottom: 8px; letter-spacing: -1px; }
        #m-skill { font-size: 12px; color: var(--text-sub); }
        
        /* 보스 등장 시 카드 강조 */
        .boss-active { border: 1px solid #fff !important; background: #1a1a1a; }

        .hp-bar-minimal { width: 100%; height: 2px; background: #222; position: relative; margin-top: 15px; }
        .hp-fill { height: 100%; background: #fff; transition: width 0.3s; }

        .player-info { margin-bottom: 8px; font-size: 11px; color: var(--text-sub); display: flex; justify-content: space-between; text-transform: uppercase; }
        .btn-action { background: #fff; color: #000; border: none; padding: 16px; width: 100%; font-weight: 800; cursor: pointer; font-size: 13px; }
        
        #log-window { height: 80px; overflow-y: auto; font-size: 11px; color: var(--text-sub); margin-top: 20px; border-top: 1px solid var(--border); padding-top: 10px; line-height: 1.6; }

        .modal { display: none; position: absolute; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.98); z-index:100; flex-direction:column; padding:40px; box-sizing: border-box; }
        .book-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; overflow-y: auto; margin: 20px 0; }
        .book-item { font-size: 11px; color: #333; border-bottom: 1px solid #111; padding-bottom: 5px; }
        .book-item.unlocked { color: #fff; }
    </style>
</head>
<body>

<div id="game-container">
    <div id="book-modal" class="modal">
        <div style="font-size: 24px; font-weight: 200; margin-bottom: 10px;">ARCHIVE</div>
        <div class="book-grid" id="book-grid"></div>
        <button onclick="toggleBook()" style="background:none; border:1px solid #333; color:#888; padding:10px; cursor:pointer;">CLOSE</button>
    </div>

    <div id="game-over" class="modal" style="justify-content: center; text-align: center;">
        <div style="font-size: 32px; font-weight: 800; margin-bottom: 10px;">LOST</div>
        <p id="death-reason" style="color: var(--text-sub); font-size: 13px; margin-bottom: 30px; line-height: 1.5;"></p>
        <button class="btn-action" onclick="location.reload()">RETRY</button>
    </div>

    <header>
        <div class="status-row">
            <div id="stage-text" class="stage-title">STAGE 01</div>
            <div class="collection-count"><span id="col-count">0</span><span style="font-size:14px; color:#444;">/50</span></div>
        </div>
        <div class="progress-bar"><div id="progress-fill"></div></div>
    </header>

    <div id="m-card" class="target-card">
        <div id="m-name">SEARCHING...</div>
        <div id="m-skill">-</div>
        <div class="hp-bar-minimal"><div id="m-hp-fill" class="hp-fill"></div></div>
    </div>

    <div class="player-section">
        <div class="player-info">
            <span>LV.<span id="p-lv">1</span> / ATK <span id="p-atk-text">10</span></span>
            <span id="p-hp-text">100 / 100</span>
        </div>
        <div class="hp-bar-minimal" style="margin-bottom: 20px; height: 4px; background: #111;">
            <div id="p-hp-fill" class="hp-fill"></div>
        </div>
        <button class="btn-action" onclick="usePotion()">RESTORE MENTAL (<span id="pot-count">2</span>)</button>
    </div>

    <div class="equip-grid">
        <div class="slot" id="slot-weapon"><span>WEAPON</span><div class="name">-</div></div>
        <div class="slot" id="slot-hat"><span>HAT</span><div class="name">-</div></div>
        <div class="slot" id="slot-top"><span>TOP</span><div class="name">-</div></div>
        <div class="slot" id="slot-bottom"><span>BOTTOM</span><div class="name">-</div></div>
        <div class="slot" id="slot-glove"><span>GLOVE</span><div class="name">-</div></div>
        <div class="slot" id="slot-neck"><span>NECK</span><div class="name">-</div></div>
        <div class="slot" id="slot-wrist"><span>WRIST</span><div class="name">-</div></div>
        <div class="slot" onclick="toggleBook()" style="cursor:pointer; background: #080808;"><span>ARCHIVE</span><div class="name" style="color:#fff">VIEW</div></div>
    </div>

    <div id="log-window"></div>
</div>

<script src="villains.js"></script>
<script src="items.js"></script>
<script>
    let p = { lv:1, hp:100, atk:10, pot:2, stage:0, book:{}, eq:{}, isBookOpen: false };
    let m = null;

    const init = () => { initBookUI(); spawn(); setInterval(tick, 1000); updateUI(); };

    const initBookUI = () => {
        const grid = document.getElementById('book-grid');
        grid.innerHTML = "";
        VILLAINS_DATA.flat().forEach(v => {
            const div = document.createElement('div');
            div.className = "book-item";
            div.id = `book-${v.name}`;
            div.innerText = "· · ·";
            grid.appendChild(div);
        });
    };

    const toggleBook = () => {
        p.isBookOpen = !p.isBookOpen;
        document.getElementById('book-modal').style.display = p.isBookOpen ? 'flex' : 'none';
    };

    const getAtk = () => p.atk + Object.values(p.eq).reduce((a,b)=> (b.slot==='weapon'||b.slot==='glove')?a+b.val:a, 0);
    const getMaxHP = () => 100 + (p.lv*10) + Object.values(p.eq).reduce((a,b)=> (['top','bottom','hat','wrist'].includes(b.slot))?a+b.val:a, 0);

    const spawn = () => {
        const raw = VILLAINS_DATA[p.stage][Math.floor(Math.random()*10)];
        const g = 1+(p.lv*0.15);
        m = { ...raw, curHp: Math.floor(raw.hp*g), maxHp: Math.floor(raw.hp*g), curAtk: Math.floor(raw.atk*g) };
        
        // 보스 배경 강조
        const card = document.getElementById('m-card');
        const nameEl = document.getElementById('m-name');
        if(m.isBoss) {
            card.classList.add('boss-active');
            nameEl.className = 'grade-unique';
        } else {
            card.classList.remove('boss-active');
            nameEl.className = '';
        }
        updateUI();
    };

    const tick = () => {
        if(p.hp <= 0 || p.isBookOpen) return;
        m.curHp -= getAtk();
        if(m.curHp <= 0) { win(); return; }
        p.hp -= m.curAtk;
        if(p.hp <= 0) { 
            document.getElementById('death-reason').innerText = m.killMsg;
            document.getElementById('game-over').style.display = 'flex'; 
        }
        updateUI();
    };

    const win = () => {
        p.book[m.name] = true; p.lv++; p.atk += 2;
        const bookEl = document.getElementById(`book-${m.name}`);
        if(bookEl) { bookEl.innerText = m.name; bookEl.classList.add('unlocked'); }

        const drop = ITEM_SYSTEM.generateDrop(m, p.stage);
        if(drop && (!p.eq[drop.slot] || p.eq[drop.slot].val < drop.val)) {
            p.eq[drop.slot] = drop;
            addLog(`Acquired ${drop.name.toUpperCase()}`);
        }
        if(Math.random()<0.5) p.pot++;
        if(VILLAINS_DATA[p.stage].every(v=>p.book[v.name]) && p.stage < 4) p.stage++;
        spawn();
    };

    const usePotion = () => {
        if(p.pot<=0) return;
        p.pot--; p.hp = Math.min(getMaxHP(), p.hp + Math.floor(getMaxHP()*0.5));
        updateUI();
    };

    const addLog = (msg) => {
        const log = document.getElementById('log-window');
        const d = document.createElement('div'); d.innerText = `+ ${msg}`;
        log.insertBefore(d, log.firstChild);
        if(log.childNodes.length > 5) log.lastChild.remove();
    };

    const updateUI = () => {
        const max = getMaxHP();
        const collected = Object.keys(p.book).length;
        document.getElementById('p-lv').innerText = p.lv;
        document.getElementById('p-atk-text').innerText = getAtk();
        document.getElementById('p-hp-text').innerText = `${Math.max(0,p.hp)} / ${max}`;
        document.getElementById('p-hp-fill').style.width = (p.hp/max*100) + "%";
        document.getElementById('m-name').innerText = m.name;
        document.getElementById('m-skill').innerText = m.skill;
        document.getElementById('m-hp-fill').style.width = (m.curHp/m.maxHp*100) + "%";
        document.getElementById('col-count').innerText = collected;
        document.getElementById('progress-fill').style.width = (collected/50*100) + "%";
        document.getElementById('pot-count').innerText = p.pot;
        document.getElementById('stage-text').innerText = `STAGE 0${p.stage + 1}`;

        ITEM_SYSTEM.slots.forEach(s => {
            const el = document.getElementById(`slot-${s}`);
            const nameEl = el.querySelector('.name');
            if(p.eq[s]) { 
                nameEl.innerText = p.eq[s].name;
                nameEl.className = `name grade-${p.eq[s].grade}`;
            }
        });
    };
    window.onload = init;
</script>
</body>
</html>