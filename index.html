<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VILLAIN HUNTER : STAGE UNLOCK</title>
    <style>
        :root {
            --bg-color: #0c0c0c; --panel-bg: #1a1a1a; --text-main: #eeeeee;
            --common: #ffffff; --rare: #ffff00; --epic: #bf00ff;
            --unique: #00f2ff; --danger: #ff4444; --border: #333333; --gold: #ffd700;
        }
        body { background: var(--bg-color); color: var(--text-main); font-family: 'Pretendard', sans-serif; display: flex; justify-content: center; padding: 20px; margin: 0; line-height: 1.4; font-size: 14px; }
        #game-container { width: 100%; max-width: 480px; background: var(--panel-bg); border-radius: 20px; padding: 25px; border: 1px solid var(--border); position: relative; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        
        /* ë„ê° ìƒì‹œ í‘œì‹œë°” */
        .book-status-bar { background: rgba(0,0,0,0.5); border-radius: 12px; padding: 12px; margin-bottom: 15px; border: 1px solid var(--gold); }
        .book-progress-bg { width: 100%; height: 8px; background: #222; border-radius: 4px; overflow: hidden; margin: 5px 0; }
        #book-progress-fill { width: 0%; height: 100%; background: linear-gradient(90deg, #ff0080, var(--gold)); transition: width 0.5s; }

        .equip-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 6px; margin-bottom: 15px; }
        .equip-slot { background: #000; border: 1px solid #444; padding: 6px; border-radius: 8px; text-align: center; font-size: 10px; height: 65px; display: flex; flex-direction: column; justify-content: center; overflow: hidden; }
        .equip-slot span { color: #888; display: block; margin-bottom: 2px; font-size: 9px; }
        .equip-name { color: #fff; font-weight: bold; line-height: 1.1; word-break: keep-all; font-size: 10px; }

        .panel { background: rgba(255,255,255,0.05); border-radius: 12px; padding: 15px; margin-bottom: 15px; border: 1px solid rgba(255,255,255,0.1); }
        .hp-bar-bg { width: 100%; height: 12px; background: #222; margin: 8px 0; border-radius: 6px; overflow: hidden; border: 1px solid #333; }
        .hp-fill { height: 100%; transition: width 0.3s; }
        
        button { background: #ffffff; color: #000000; border: none; padding: 12px; cursor: pointer; font-weight: 900; border-radius: 8px; width: 100%; font-size: 14px; }
        .btn-small { width: auto; padding: 4px 10px; font-size: 10px; background: var(--gold); border: none; font-weight: bold; }

        #log-window { height: 120px; overflow-y: auto; font-size: 12px; color: #bbb; padding: 10px; background: #000; border-radius: 10px; border: 1px solid #333; margin-top: 10px; }
        .log-entry { margin-bottom: 4px; border-bottom: 1px solid #111; }
        
        .modal { display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 100; background: rgba(0,0,0,0.95); flex-direction: column; align-items: center; justify-content: center; border-radius: 20px; padding: 20px; box-sizing: border-box; }
        #book-modal { overflow-y: auto; }
        .book-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 6px; width: 100%; }
        .book-item { padding: 5px; background: #222; border-radius: 4px; font-size: 10px; border: 1px solid #333; color: #444; }
        .book-item.unlocked { color: #fff; border-color: var(--unique); }
        .book-item.rare-unlocked { border-color: var(--epic); color: var(--epic); font-weight: bold; }
        
        .skill-name { color: var(--danger); font-weight: bold; }
        .stage-notice { color: var(--unique); font-size: 12px; font-weight: bold; }
    </style>
</head>
<body>

<div id="game-container">
    <div id="game-over" class="modal">
        <h1 style="color:var(--danger); font-size: 32px;">MENTAL BREAK</h1>
        <div id="killer-name" style="color: #fff; margin-bottom: 10px;"></div>
        <div id="death-quote" style="font-style: italic; color: #888; margin-bottom: 20px;"></div>
        <button onclick="location.reload()">ë‹¤ì‹œ ì‹œì‘</button>
    </div>

    <div id="book-modal" class="modal">
        <h2 style="color:var(--gold);">ì „ì²´ ë¹ŒëŸ° ë„ê°</h2>
        <div class="book-grid" id="book-grid"></div>
        <button onclick="toggleBook()" style="margin-top: 15px;">ë‹«ê¸°</button>
    </div>

    <div class="book-status-bar">
        <div style="display:flex; justify-content:space-between; align-items: flex-end;">
            <div>
                <span class="stage-notice" id="current-stage-text">STAGE 1: ì¼ìƒì˜ ì—­ê²½</span><br>
                <span style="font-size:18px; font-weight:900; color:var(--gold);">COLLECT <span id="book-main-count">0</span>/50</span>
            </div>
            <div id="player-title" style="font-size:11px; color:var(--unique); border:1px solid var(--unique); padding:2px 5px; border-radius:4px;">ì‹ ì… ì‚¬ì›</div>
        </div>
        <div class="book-progress-bg"><div id="book-progress-fill"></div></div>
        <div style="font-size:9px; color:#777; text-align:right;">*í˜„ì¬ ê·¸ë£¹ 10ì¢… ìˆ˜ì§‘ ì‹œ ë‹¤ìŒ ìŠ¤í…Œì´ì§€ í•´ê¸ˆ</div>
    </div>

    <div class="panel">
        <div class="equip-grid">
            <div class="equip-slot"><span>ê³µê²©</span><div class="equip-name" id="eq-weapon">ë§¨ì£¼ë¨¹</div></div>
            <div class="equip-slot"><span>ëª¨ì</span><div class="equip-name" id="eq-hat">-</div></div>
            <div class="equip-slot"><span>ìƒì˜</span><div class="equip-name" id="eq-top">-</div></div>
            <div class="equip-slot"><span>í•˜ì˜</span><div class="equip-name" id="eq-bottom">-</div></div>
            <div class="equip-slot"><span>ì¥ê°‘</span><div class="equip-name" id="eq-glove">-</div></div>
            <div class="equip-slot"><span>ëª©ê±¸ì´</span><div class="equip-name" id="eq-neck">-</div></div>
            <div class="equip-slot"><span>ì†ëª©</span><div class="equip-name" id="eq-wrist">-</div></div>
            <div class="equip-slot" style="border-color: var(--gold);"><span>LV</span><div class="equip-name" id="lv-display">1</div></div>
        </div>
        <div style="display:flex; justify-content:space-between; font-size: 11px; color: #aaa;">
            <span id="stat-atk">ë§ë¹¨: 10</span>
            <span id="stat-crit">ì¹˜ëª…: 5%</span>
            <span id="stat-dodge">íšŒí”¼: 5%</span>
        </div>
        <div class="hp-bar-bg"><div id="p-hp-bar" class="hp-fill" style="background:#fff; width:100%;"></div></div>
        <button id="heal-btn" onclick="usePotion()" style="background:#444; color:#fff; padding:8px;">ğŸ• íšŒë³µ ì•„ì´í…œ <span id="heal-count">(0)</span></button>
    </div>

    <div class="panel" style="border-left: 4px solid var(--danger); background: rgba(255,0,0,0.1);">
        <div style="display:flex; justify-content:space-between; align-items: center;">
            <div id="m-name" style="font-weight:900; font-size: 15px;">ë¹ŒëŸ° íƒìƒ‰ ì¤‘...</div>
            <div id="m-hp-text" style="font-size: 11px; color: #888;">0 / 0</div>
        </div>
        <div class="hp-bar-bg"><div id="m-hp-bar" class="hp-fill" style="background:var(--danger); width:100%;"></div></div>
    </div>

    <div id="log-window"></div>
    <button onclick="toggleBook()" style="margin-top:10px; font-size:11px; background:none; color:#666; border:1px solid #333;">ìƒì„¸ ë„ê° ë³´ê¸°</button>
</div>

<script>
    // 50ì¢… ë¹ŒëŸ°ì„ 10ë§ˆë¦¬ì”© 5ê·¸ë£¹ìœ¼ë¡œ ë¶„ë¦¬
    const MONSTER_GROUPS = [
        [ // Group 1: ì¼ìƒì˜ ì—­ê²½ (LV 1~10 ì¶”ì²œ)
            { name: "ì¶œê·¼ ëŒ€ë¦¬ë‹˜", hp: 60, atk: 6, skill: "ì„œë¥˜ ë˜ì§€ê¸°", killMsg: "ê±° ê¹€ëŒ€ë¦¬, ì´ ì„œë¥˜ ì˜¤ëŠ˜ê¹Œì§€ì•¼.", unique: {type: 'weapon', name: "â˜… ëŒ€ë¦¬ë‹˜ì˜ ì„œë¥˜ë­‰ì¹˜", val: 40} },
            { name: "ìŠ¤íŒ¸ ì „í™” 070", hp: 45, atk: 5, skill: "ê¿€ì  ë°©í•´", killMsg: "ë‚®ì  ìëŠ”ë° ëŒ€ì¶œ ê¶Œìœ ë¼ë‹ˆ.", unique: {type: 'wrist', name: "â˜… ìŠ¤íŒ¸ ì°¨ë‹¨ê¸°", val: 15} },
            { name: "ë°ì´í„° ì—†ëŠ” í°", hp: 50, atk: 8, skill: "ì˜¤í”„ë¼ì¸ ê³ ë¦½", killMsg: "ë¡œë”© ìŠ¤í”¼ë„ˆë§Œ 10ë¶„ì§¸.", unique: {type: 'wrist', name: "â˜… ë¬´ì œí•œ ì—ê·¸", val: 20} },
            { name: "USB ë°˜ëŒ€ë¡œ ë¼ì›€", hp: 50, atk: 5, skill: "ë‹¨ì ì…êµ¬ë§‰ê¸°", killMsg: "ë’¤ì§‘ì–´ë„ ì•ˆ ë“¤ì–´ê°€ìš”.", unique: {type: 'glove', name: "â˜… Cíƒ€ì… ì  ë”", val: 15} },
            { name: "ì•ˆ ì”»ì€ í…€ë¸”ëŸ¬", hp: 60, atk: 10, skill: "ê³°íŒ¡ì´ í–¥ê¸°", killMsg: "ì»¤í”¼ì—ì„œ ëœì¥ ë§›ì´ ë‚©ë‹ˆë‹¤.", unique: {type: 'glove', name: "â˜… ì‚´ê·  ì„¸ì²™ ì†”", val: 20} },
            { name: "ëˆ…ëˆ…í•œ ì‹œë¦¬ì–¼", hp: 45, atk: 5, skill: "ì¢…ì´ ì‹ê°", killMsg: "ì¢…ì´ ì”¹ëŠ” ì¤„ ì•Œì•˜ìŠµë‹ˆë‹¤.", unique: {type: 'neck', name: "â˜… ë°€í ìš©ê¸°", val: 15} },
            { name: "ì•ˆí„°ì§€ëŠ” WIFI", hp: 70, atk: 12, skill: "ë¬´í•œ ë¡œë”©", killMsg: "ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ëŒ€ìš”.", unique: {type: 'wrist', name: "â˜… ì™€ì´íŒŒì´ ì¦í­ê¸°", val: 25} },
            { name: "ì¹¨ëŒ€ ë°‘ ë¦¬ëª¨ì»¨", hp: 75, atk: 10, skill: "êµ¬ì„ ìˆ¨ê¸°ê¸°", killMsg: "ê²°êµ­ ì¼ì–´ë‚˜ì„œ ê»ìŠµë‹ˆë‹¤.", unique: {type: 'hat', name: "â˜… ë‡ŒíŒŒ ì¡°ì¢… ë°´ë“œ", val: 20} },
            { name: "ë¹¨ê°„ë¶ˆ íš¡ë‹¨ë³´ë„", hp: 80, atk: 12, skill: "ë²„ìŠ¤ ë†“ì¹˜ê¸°", killMsg: "ë²„ìŠ¤ê°€ ë°©ê¸ˆ ë– ë‚¬ìŠµë‹ˆë‹¤.", unique: {type: 'bottom', name: "â˜… ëŸ°ë‹í™”", val: 30} },
            { name: "ê´‘ê³  ìŠ¤í‚µ ë¶ˆê°€", hp: 85, atk: 13, skill: "ê°•ì œ 15ì´ˆ", killMsg: "15ì´ˆê°€ 15ë…„ ê°™ì•˜ìŠµë‹ˆë‹¤.", unique: {type: 'top', name: "â˜… í”„ë¦¬ë¯¸ì—„ ë©¤ë²„ì‹­", val: 30} }
        ],
        [ // Group 2: ì‚¬íšŒì˜ ë§¤ìš´ë§›
            { name: "ë²•ì¹´ ë¶€ì¥ë‹˜", hp: 120, atk: 18, skill: "ê°‘ì‘ìŠ¤ëŸ° íšŒì‹", killMsg: "ì˜¤ëŠ˜ íšŒì‹ì€ ì‚¼ê²¹ì‚´ì´ë‹¤!", unique: {type: 'neck', name: "â˜… ë²•ì¸ì¹´ë“œ", val: 40} },
            { name: "ë¼ë–¼ ì°¨ì¥ë‹˜", hp: 140, atk: 20, skill: "ë‚˜ ë•ŒëŠ” ë§ì´ì•¼", killMsg: "ë‚˜ ë•ŒëŠ” ë§ì´ì•¼...", unique: {type: 'hat', name: "â˜… ì „ìš© ì°»ì”", val: 45} },
            { name: "ì´ì–´í° í•œìª½ ê³ ì¥", hp: 130, atk: 15, skill: "ëª¨ë…¸ ì‚¬ìš´ë“œ", killMsg: "ì™¼ìª½ ê·€ê°€ ì™¸ë¡­ìŠµë‹ˆë‹¤.", unique: {type: 'hat', name: "â˜… ê³¨ì „ë„ í—¤ë“œì…‹", val: 40} },
            { name: "ì¹´ê³µì¡±ì˜ ëˆˆì´", hp: 110, atk: 15, skill: "í•œìˆ¨ ì‰¬ê¸°", killMsg: "í‚¤ë³´ë“œ ì†Œë¦¬ê°€ ì£„ì¸ê°€ìš”?", unique: {type: 'glove', name: "â˜… ë¬´ì†ŒìŒ ìŠ¤í‚¨", val: 30} },
            { name: "ë³´ì´ìŠ¤ í”¼ì‹±", hp: 150, atk: 22, skill: "ê²€ì°° ì‚¬ì¹­", killMsg: "ì„œìš¸ ì¤‘ì•™ ì§€ê²€ì´ë¼ë©´ì„œìš”.", unique: {type: 'neck', name: "â˜… í†µí™” ë…¹ìŒê¸°", val: 40} },
            { name: "ë¬´í•œ ë¡œë”© ì§€ì˜¥", hp: 160, atk: 20, skill: "ë±…ê¸€ë±…ê¸€ ì €ì£¼", killMsg: "ë¹™ê¸€ë¹™ê¸€ ì§€ì˜¥.", unique: {type: 'wrist', name: "â˜… ê¸°ê°€ ì¸í„°ë„·", val: 35} },
            { name: "ì•ˆ ì§€ì›Œì§€ëŠ” ì–¼ë£©", hp: 145, atk: 18, skill: "ë§ˆë¼íƒ• ê³µê²©", killMsg: "ìµœì•  ì…”ì¸ ì— ë§ˆë¼íƒ•ì„...", unique: {type: 'top', name: "â˜… ì–¼ë£© ì œê±° ìŠ¤í‹±", val: 45} },
            { name: "ì•ˆ ì—´ë¦¬ëŠ” ëšœê»‘", hp: 155, atk: 16, skill: "ì§„ê³µ ë°€ì°©", killMsg: "ê³ ë¬´ì¥ê°‘ ê»´ë„ ì•ˆ ì—´ë ¤ìš”.", unique: {type: 'glove', name: "â˜… ì•„ê·€í˜ ì¥ê°‘", val: 45} },
            { name: "ê²¨ìš¸ ì •ì „ê¸°", hp: 170, atk: 25, skill: "ì°Œë¦¿ì°Œë¦¿", killMsg: "ì†ëì´ íƒ€ë“¤ì–´ê°‘ë‹ˆë‹¤.", unique: {type: 'glove', name: "â˜… ì ˆì—° ì¥ê°‘", val: 50} },
            { name: "ë§Œì› ë²„ìŠ¤ ë°±íŒ©", hp: 180, atk: 22, skill: "ì§„ë¡œ ë°©í•´", killMsg: "ê°€ë°©ì— ë°€ë ¤ ëª» ë‚´ë ¸ìŠµë‹ˆë‹¤.", unique: {type: 'top', name: "â˜… ë°±íŒ© ë°©ì–´ í‰ê°‘", val: 50} }
        ],
        [ // Group 3: ë©˜íƒˆ ë¶•ê´´ì˜ ì„œë§‰
            { name: "í‡´ê·¼ì§ì „ íŒ€ì¥ë‹˜", hp: 350, atk: 45, skill: "ì´ê²ƒë§Œ í•˜ê³  ê°€", killMsg: "ì•„ ê°€ê¸° ì „ì— ì´ê²ƒë§Œ ì¢€...", unique: {type: 'wrist', name: "â˜… ì¹¼í‡´ ì›Œì¹˜", val: 70} },
            { name: "ì½ì”¹ ì¸ë…€", hp: 320, atk: 50, skill: "ì•ˆ ì½ìŒ 1", killMsg: "ìˆ«ì 1ì˜ ì••ë°•.", unique: {type: 'neck', name: "â˜… ë©˜íƒˆ ë³µêµ¬ ì‚¬ì§„", val: 70} },
            { name: "ì¸µê°„ì†ŒìŒ ë§ì¹˜", hp: 380, atk: 55, skill: "ì²œì¥ ë“œë¦´ë§", killMsg: "ìœ—ì§‘ì— ë§ì¹˜ì§ˆ ì‹ ì´ ì‚½ë‹ˆë‹¤.", unique: {type: 'hat', name: "â˜… ì°¨ë‹¨ í—¬ë©§", val: 80} },
            { name: "ë¹„ì˜¤ëŠ” í° ìš´ë™í™”", hp: 340, atk: 40, skill: "ì§„í™íƒ• ìŠ¤í”Œë˜ì‹œ", killMsg: "ì‹ ë°œì´ ëŠªì´ ë˜ì—ˆìŠµë‹ˆë‹¤.", unique: {type: 'bottom', name: "â˜… ë°©ìˆ˜ ì½”íŒ…", val: 75} },
            { name: "ë¹„ë²ˆ 5íšŒ ì˜¤ë¥˜", hp: 400, atk: 60, skill: "ë¡œê·¸ì¸ ì ê¸ˆ", killMsg: "30ì´ˆ ë’¤ì— ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.", unique: {type: 'wrist', name: "â˜… ì§€ë¬¸ ì¸ì‹", val: 85} },
            { name: "ê³ ì¥ë‚œ í‚¤ë³´ë“œ", hp: 420, atk: 55, skill: "ì—”í„°í‚¤ ë¨¹í†µ", killMsg: "ì—”í„°í‚¤ê°€ ë¹ ì¡ŒìŠµë‹ˆë‹¤.", unique: {type: 'weapon', name: "â˜… ì²­ì¶• í‚¤ë³´ë“œ", val: 100} },
            { name: "ì˜†ì§‘ íƒë°° ì˜¤ë°°ì†¡", hp: 390, atk: 45, skill: "ì‹ ì„ ë„ í•˜ë½", killMsg: "ëƒ‰ë™ì‹í’ˆì´ ë‹¤ ë…¹ì•˜ìŠµë‹ˆë‹¤.", unique: {type: 'neck', name: "â˜… íƒë°° ì¶”ì ê¸°", val: 80} },
            { name: "ì¤‘ê³ ë‚˜ë¼ ë²½ëŒ", hp: 450, atk: 65, skill: "íƒë°° ë°”ê¿”ì¹˜ê¸°", killMsg: "ì•„ì´í° ëŒ€ì‹  ë²½ëŒì´ ì˜´.", unique: {type: 'weapon', name: "â˜… ì‚¬ê¸°ê¾¼ ì˜ì¥", val: 120} },
            { name: "ìœ í†µê¸°í•œ ì§€ë‚œ ìš°ìœ ", hp: 430, atk: 70, skill: "ë³µí†µ ìœ ë°œ", killMsg: "ì¥ì´ ê¼¬ì—¬ë²„ë ¸ìŠµë‹ˆë‹¤.", unique: {type: 'bottom', name: "â˜… ìœ ì‚°ê·  ë³´í˜¸ë³µ", val: 90} },
            { name: "ì¡°ë³„ê³¼ì œ í”„ë¦¬ë¼ì´ë”", hp: 480, atk: 55, skill: "ì ìˆ˜ íƒ€ê¸°", killMsg: "ì € í• ì•„ë²„ì§€ê°€ í¸ì°®ìœ¼ì…”ì„œ...", unique: {type: 'top', name: "â˜… ë¬´ì„ìŠ¹ì°¨ ê±°ë¶€ê¶Œ", val: 100} }
        ],
        [ // Group 4: í˜„ì‹¤ì˜ ê³µí¬
            { name: "ìƒˆë¼ë°œê°€ë½ ì°§ìŒ", hp: 1200, atk: 180, skill: "ëª¨ì„œë¦¬ ê³µê²©", killMsg: "ì •ì‹ ì´ ì•„ë“í•´ì§‘ë‹ˆë‹¤.", unique: {type: 'bottom', name: "â˜… ë°©ì§€ ì¿ ì…˜", val: 150} },
            { name: "ì €ì¥ ì•ˆí•œ ë¬¸ì„œ", hp: 1300, atk: 200, skill: "ì‘ë‹µ ì—†ìŒ", killMsg: "ë¸”ë£¨ìŠ¤í¬ë¦°ì€ ì˜ˆê³  ì—†ì´ ì˜µë‹ˆë‹¤.", unique: {type: 'top', name: "â˜… ìë™ ì €ì¥", val: 160} },
            { name: "ê¸‰ë˜¥ ì‹ í˜¸", hp: 1100, atk: 160, skill: "ì¥ ë’¤í‹€ê¸°", killMsg: "ì§€í•˜ì² ì€ ê¸‰í–‰ì´ì—ˆìŠµë‹ˆë‹¤.", unique: {type: 'bottom', name: "â˜… ê´„ì•½ê·¼ ì¡°ì ˆê¸°", val: 140} },
            { name: "ì…ê¸ˆ ì „ í´ë¼ì´ì–¸íŠ¸", hp: 1500, atk: 220, skill: "ë¬´í•œ ìˆ˜ì •", killMsg: "ì¢€ ë” í™”ë ¤í•˜ê³  ì‹¬í”Œí•˜ê²Œ!", unique: {type: 'weapon', name: "â˜… ì§„ì§œìµœì¢….psd", val: 200} },
            { name: "ê³µê³µì¥ì†Œ ì•¼ë™ìŠ¤í”¼ì»¤", hp: 1800, atk: 300, skill: "ê°•ì œ ìˆ˜ì¹˜ì‚¬", killMsg: "ëª¨ë“  ì‹œì„ ì´ ë‹¹ì‹ ì—ê²Œ...", unique: {type: 'hat', name: "â˜… ìˆ˜ì¹˜ì‚¬ ë°©ì§€ê°€ë©´", val: 250} },
            { name: "ì˜ëª» ë³´ë‚¸ ì¹´í†¡", hp: 1400, atk: 190, skill: "ì „ì†¡ ì·¨ì†Œ ì‹¤íŒ¨", killMsg: "ë¶€ì¥ë‹˜ê»˜ 'ì‚¬ë‘í•´'ë¼ê³  ë³´ëƒ„.", unique: {type: 'wrist', name: "â˜… ì·¨ì†Œ ë²„íŠ¼", val: 150} },
            { name: "ê¹œë¹¡í•œ ì—ì–´ì»¨", hp: 1600, atk: 150, skill: "ì „ê¸°ë£Œ í­íƒ„", killMsg: "ê³ ì§€ì„œì— 0ì´ í•˜ë‚˜ ë”...", unique: {type: 'bottom', name: "â˜… ì—ë„ˆì§€ ë°”ì§€", val: 180} },
            { name: "ğŸ‘‘ ì›”ìš”ì¼ 8:59AM", hp: 3000, atk: 350, skill: "ì•ŒëŒ ì§€ì˜¥", killMsg: "ì§€ì˜¥ì˜ 5ì¼ì´ ì‹œì‘ëœë‹¤.", unique: {type: 'weapon', name: "â˜… ì›”ìš”ì¼ íŒŒì‡„ê¸°", val: 400} },
            { name: "ğŸ‘‘ ìœˆë„ìš° ì—…ë°ì´íŠ¸", hp: 3200, atk: 300, skill: "ê°•ì œ ì¬ë¶€íŒ…", killMsg: "ì—…ë°ì´íŠ¸ëŠ” ì˜ˆê³ ê°€ ì—†ì£ .", unique: {type: 'glove', name: "â˜… ê°•ì œ ì¢…ë£Œê¶Œ", val: 350} },
            { name: "ğŸ‘‘ ëª…ì ˆ ì”ì†Œë¦¬", hp: 2800, atk: 280, skill: "ê²°í˜¼/ì·¨ì—… ì½¤ë³´", killMsg: "ë„ˆëŠ” ì–¸ì œ ì˜ë˜ë‹ˆ?", unique: {type: 'hat', name: "â˜… ì°¨ë‹¨ ì´ì–´í”ŒëŸ¬ê·¸", val: 300} }
        ],
        [ // Group 5: ì‚¬íšŒì  ì¢…ë§
            { name: "ğŸ‘‘ ì˜ˆë¹„êµ° í†µì§€ì„œ", hp: 6000, atk: 500, skill: "ê°•ì œ ì…ì†Œ", killMsg: "ì¶•í•˜í•©ë‹ˆë‹¤. ë™ì›ì…ë‹ˆë‹¤.", unique: {type: 'top', name: "â˜… ê°œêµ¬ë¦¬ ì „íˆ¬ë³µ", val: 500} },
            { name: "ğŸ‘‘ ëˆ„ì§„ì„¸ ê³ ì§€ì„œ", hp: 7500, atk: 600, skill: "ìš”ê¸ˆ í­ê²©", killMsg: "ì—¬ë¦„ì€ ì‹œì›í–ˆì§€ë§Œ...", unique: {type: 'bottom', name: "â˜… ì „ì› ì°¨ë‹¨ê¸°", val: 600} },
            { name: "ğŸ‘‘ ì•¡ì • íŒŒì†", hp: 7000, atk: 550, skill: "ê±°ë¯¸ì¤„ í¬ë™", killMsg: "30ë§Œì›ì´ ë‚ ì•„ê°”ìŠµë‹ˆë‹¤.", unique: {type: 'wrist', name: "â˜… ë°©íƒ„ ìœ ë¦¬", val: 550} },
            { name: "ğŸ‘‘ ìë‹ˆ? ì „ì• ì¸", hp: 5500, atk: 700, skill: "ì¶”ì–µ íŒ”ì´", killMsg: "ìƒˆë²½ 2ì‹œì—” ìì•¼ í•©ë‹ˆë‹¤.", unique: {type: 'neck', name: "â˜… ë²ˆí˜¸ ë³€ê²½ê¶Œ", val: 500} },
            { name: "ğŸ‘‘ ì„œë²„ ì ê²€ ì¤‘", hp: 6500, atk: 450, skill: "ë¬´í•œ ì—°ì¥", killMsg: "ì ê²€ì€ ëŠ˜ ê¸¸ì–´ì§‘ë‹ˆë‹¤.", unique: {type: 'glove', name: "â˜… ì ì‹¬ ë³´ì¥ê¶Œ", val: 450} },
            { name: "ğŸ‘‘ ë¶€ì¥ë‹˜ ê°œì¸ê¸°", hp: 6200, atk: 480, skill: "ì•„ì¬ ê°œê·¸", killMsg: "ì•ˆ ì›ƒìœ¼ë©´ í‰ê°€ í•˜ë½.", unique: {type: 'top', name: "â˜… ë¦¬ì•¡ì…˜ ìƒì„±ê¸°", val: 500} },
            { name: "ğŸ‘‘ ë¹„ìƒê¸ˆ ê±¸ë¦¼", hp: 8000, atk: 800, skill: "ìê¸ˆ ì••ìˆ˜", killMsg: "ê·¸ê±¸ ì™œ ê±°ê¸° ìˆ¨ê²¼ë‹ˆ.", unique: {type: 'neck', name: "â˜… ì´ì¤‘ ê¸ˆê³ ", val: 800} },
            { name: "ğŸ‘‘ í‡´ì‚¬ ì„œë¥˜ ë°˜ë ¤", hp: 10000, atk: 1000, skill: "ì¢…ì‹  ê³„ì•½", killMsg: "ë‚˜ê°ˆ ë• ë§ˆìŒëŒ€ë¡œ ëª» ë‚˜ê°„ë‹¨ë‹¤.", unique: {type: 'weapon', name: "â˜… ì „ì„¤ì˜ ì‚¬ì§ì„œ", val: 1500} },
            { name: "ğŸ‘‘ ëŒ€ì¶œ ì´ì ì¸ìƒ", hp: 12000, atk: 1200, skill: "ì˜ëŒ íŒŒì‚°", killMsg: "ì´ìë§Œ ë‚´ë‹¤ ì¸ìƒ ëë‚©ë‹ˆë‹¤.", unique: {type: 'neck', name: "â˜… ê¸ˆë¦¬ ë™ê²°ê¶Œ", val: 1200} },
            { name: "ğŸ‘‘ ìµœì¢… ë³´ìŠ¤: ì¸ì‚¬íŒ€ì¥", hp: 20000, atk: 1500, skill: "ê¶Œê³ ì‚¬ì§ ê³ ì§€", killMsg: "ê·¸ë™ì•ˆ ìˆ˜ê³  ë§ìœ¼ì…¨ìŠµë‹ˆë‹¤.", unique: {type: 'top', name: "â˜… ë¬´ì ì˜ ê±´ë¬¼ì£¼ ì¦ëª…", val: 2000} }
        ]
    ];

    const ITEM_NAMES = {
        weapon: ["ë¹ˆ ë¬¼ë³‘", "ì˜ ê°ˆë¦° ì—°í•„", "í‹°ìŠ¤í‘¼", "ì „ê³µì„œì ", "íŒ©íŠ¸ í­ê²©ê¸°", "ê¸ˆìœµì¹˜ë£Œ ì£¼ë¬¸ì„œ", "ë¡œë˜ ë‹¹ì²¨ê¶Œ", "ê±´ë¬¼ ë“±ê¸°", "ì ˆëŒ€ì  ì•„ë‹ˆì˜¤"],
        hat: ["êµ¬ë©ë‚œ ë¹„ë‹ˆ", "ì‚¬íšŒì  ê°€ë©´", "ê°•ì²  ë©˜íƒˆ íˆ¬êµ¬", "í•´íƒˆì˜ ì„œí´ë¦¿", "ììœ ì˜ ê´‘íœ˜"],
        top: ["ëŠ˜ì–´ë‚œ í‹°ì…”ì¸ ", "ì›”ê¸‰ìŸì´ ê°‘ì˜·", "ë¹„ë‚œ ë°˜ì‚¬ íŒ¨ë”©", "ì—°ë´‰í˜‘ìƒ ê°€í˜¸", "ë¬´ì ì˜ ë¡œë¸Œ"],
        bottom: ["ì¶”ë¦¬ë‹", "ì¸ë‚´ì‹¬ì˜ íƒ€ì´ì¦ˆ", "íƒˆì¶œìš© ëŸ¬ë‹ ë°”ì§€", "í•˜ëŠ˜ì„ ê±·ëŠ” ë°”ì§€", "ë¶ˆë©¸ì˜ ì¶œê·¼ ë°”ì§€"],
        glove: ["ëª©ì¥ê°‘", "ê´‘í´ ì¥ê°‘", "ì‹ ì˜ ì†ê°€ë½", "ì‹¬ì—°ì˜ íŒ¨ë“œ", "ìš°ì£¼ì˜ ì¡°ìœ¨ì"],
        neck: ["ë‚¡ì€ ì‚¬ì›ì¦", "í–‰ìš´ì˜ í´ë¡œë²„", "ìš”ì •ì˜ ëˆˆë¬¼", "ì˜ê²ì˜ ë³´ë„ˆìŠ¤", "ìš´ëª…ì˜ ì—´ì‡ "],
        wrist: ["ì†ëª©ë°´ë“œ", "ë””ì§€í„¸ ì‹œê³„", "ìŠ¤ë§ˆíŠ¸ ë°´ë“œ", "í‹°íƒ€ëŠ„ ì›Œì¹˜", "ìš´ëª…ì˜ ê²°ì¬ ë¼ì¸"]
    };

    let player = {
        lv: 1, hp: 100, gold: 0, potion: 2, kills: 0, book: {}, currentStage: 0,
        base: { atk: 10, hp: 100, crit: 5, dodge: 5 },
        equip: { weapon: null, hat: null, top: null, bottom: null, glove: null, neck: null, wrist: null }
    };
    let monster = null;
    let bookOpen = false;

    function init() {
        spawn(); updateUI(); initBook();
        setInterval(battle, 1000);
    }

    function initBook() {
        const grid = document.getElementById('book-grid'); grid.innerHTML = "";
        MONSTER_GROUPS.forEach((group, gIdx) => {
            group.forEach(m => {
                const div = document.createElement('div');
                div.className = "book-item"; div.id = `book-${m.name}`;
                div.innerText = `[G${gIdx+1}] ???`; grid.appendChild(div);
            });
        });
    }

    function checkStage() {
        // í˜„ì¬ ê·¸ë£¹ì˜ 10ë§ˆë¦¬ê°€ ëª¨ë‘ ë„ê°ì— ìˆëŠ”ì§€ í™•ì¸
        const currentGroup = MONSTER_GROUPS[player.currentStage];
        const allCleared = currentGroup.every(m => player.book[m.name]);
        
        if (allCleared && player.currentStage < 4) {
            player.currentStage++;
            addLog(`<span style="color:var(--gold); font-weight:bold;">ğŸ‰ STAGE ${player.currentStage + 1} í•´ê¸ˆ! ìƒˆë¡œìš´ ë¹ŒëŸ°ë“¤ì´ ë‚˜íƒ€ë‚©ë‹ˆë‹¤!</span>`);
        }
    }

    function spawn() {
        // í˜„ì¬ í•´ê¸ˆëœ ìŠ¤í…Œì´ì§€ ê·¸ë£¹ ë‚´ì—ì„œ ëœë¤ ìŠ¤í°
        const pool = MONSTER_GROUPS[player.currentStage];
        const d = pool[Math.floor(Math.random() * pool.length)];
        const isRare = d.name.includes("ğŸ‘‘");
        const growth = 1 + (player.lv * 0.2);
        
        monster = {
            ...d, hp: Math.floor(d.hp * growth), max: Math.floor(d.hp * growth),
            atk: Math.floor(d.atk * growth), isRare: isRare
        };
        addLog(`[Stage ${player.currentStage+1}] <b>${monster.name}</b> ì¶œí˜„!`);
        updateUI();
    }

    function getStats() {
        let s = { ...player.base };
        for(let t in player.equip) {
            let item = player.equip[t]; if(!item) continue;
            if(t === 'weapon') s.atk += item.val;
            else if(t === 'neck') s.dodge = Math.min(50, s.dodge + (item.val/5));
            else if(t === 'wrist') s.crit = Math.min(75, s.crit + (item.val/5));
            else s.hp += item.val * 5;
        }
        return s;
    }

    function battle() {
        if (player.hp <= 0 || bookOpen) return;
        let s = getStats();
        let critHit = Math.random() * 100 < s.crit;
        monster.hp -= s.atk * (critHit ? 2 : 1);
        
        if (monster.hp <= 0) { win(); return; }

        if (Math.random() * 100 < s.dodge) {
            addLog(`ğŸ’¨ íšŒí”¼! <span class="skill-name">${monster.skill}</span> ë¬´ì‹œ.`);
        } else {
            player.hp -= monster.atk;
            addLog(`ğŸ’¢ <span class="skill-name">${monster.skill}</span>! -${monster.atk}`);
            if (player.hp <= 0) die();
        }
        updateUI();
    }

    function win() {
        player.kills++; player.lv++; player.book[monster.name] = true;
        let s = getStats();
        player.hp = Math.min(s.hp, player.hp + Math.floor(s.hp * 0.4));
        player.potion++;
        
        addLog(`<span style="color:var(--gold)">[ì„±ê³µ]</span> ğŸ•+1 íšë“!`);
        
        // ë„ê° ì—…ë°ì´íŠ¸
        const bookEl = document.getElementById(`book-${monster.name}`);
        if(bookEl) {
            bookEl.innerText = monster.name;
            bookEl.classList.add(monster.isRare ? 'rare-unlocked' : 'unlocked');
        }

        checkStage(); // ìŠ¤í…Œì´ì§€ í´ë¦¬ì–´ ì²´í¬

        if (monster.unique && Math.random() < 0.1) {
            let u = monster.unique;
            if (!player.equip[u.type] || player.equip[u.type].val < u.val) {
                player.equip[u.type] = { name: u.name, val: u.val, isUnique: true };
                addLog(`<span style="color:var(--unique)">â˜… ìœ ë‹ˆí¬ ì¥ì°©: [${u.name}]</span>`);
            }
        } else { dropItem(); }
        spawn();
    }

    function dropItem() {
        const types = Object.keys(ITEM_NAMES);
        const type = types[Math.floor(Math.random() * types.length)];
        const pool = ITEM_NAMES[type];
        const tier = Math.min(pool.length - 1, Math.floor(player.lv / 5));
        const val = (tier + 1) * 20 + player.lv;
        let newItem = { name: pool[tier], val: val, tier: tier };
        
        if (!player.equip[type] || player.equip[type].val < newItem.val) {
            player.equip[type] = newItem;
            addLog(`íšë“: [${newItem.name}]`);
        }
    }

    function usePotion() {
        let s = getStats();
        if (player.potion > 0) {
            player.potion--; player.hp = Math.min(s.hp, player.hp + Math.floor(s.hp * 0.7));
            addLog("ğŸ• ë©˜íƒˆ íšŒë³µ ì™„ë£Œ!"); updateUI();
        }
    }

    function die() {
        player.hp = 0;
        document.getElementById('killer-name').innerText = monster.name;
        document.getElementById('death-quote').innerText = `"${monster.killMsg}"`;
        document.getElementById('game-over').style.display = 'flex';
    }

    function addLog(msg) {
        const logWin = document.getElementById('log-window');
        const div = document.createElement('div'); div.className = "log-entry";
        div.innerHTML = msg;
        logWin.insertBefore(div, logWin.firstChild);
        if (logWin.childNodes.length > 20) logWin.lastChild.remove();
    }

    function toggleBook() {
        bookOpen = !bookOpen;
        document.getElementById('book-modal').style.display = bookOpen ? 'flex' : 'none';
    }

    function updateUI() {
        let s = getStats();
        document.getElementById('p-hp-bar').style.width = (player.hp / s.hp * 100) + "%";
        document.getElementById('m-name').innerText = monster.name;
        document.getElementById('m-hp-text').innerText = `${Math.max(0, monster.hp)} / ${monster.max}`;
        document.getElementById('m-hp-bar').style.width = (monster.hp / monster.max * 100) + "%";
        document.getElementById('stat-atk').innerText = `ë§ë¹¨: ${s.atk}`;
        document.getElementById('stat-crit').innerText = `ì¹˜ëª…: ${s.crit.toFixed(1)}%`;
        document.getElementById('stat-dodge').innerText = `íšŒí”¼: ${s.dodge.toFixed(1)}%`;
        document.getElementById('lv-display').innerText = player.lv;
        document.getElementById('heal-count').innerText = `(${player.potion})`;
        
        const count = Object.keys(player.book).length;
        document.getElementById('book-main-count').innerText = count;
        document.getElementById('book-progress-fill').style.width = (count / 50 * 100) + "%";
        
        const stages = ["ì¼ìƒì˜ ì—­ê²½", "ì‚¬íšŒì˜ ë§¤ìš´ë§›", "ë©˜íƒˆ ë¶•ê´´ì˜ ì„œë§‰", "í˜„ì‹¤ì˜ ê³µí¬", "ì‚¬íšŒì  ì¢…ë§"];
        document.getElementById('current-stage-text').innerText = `STAGE ${player.currentStage + 1}: ${stages[player.currentStage]}`;

        for (let t in player.equip) {
            const el = document.getElementById(`eq-${t}`);
            const item = player.equip[t];
            if (item) {
                el.innerText = item.name;
                if(item.isUnique) el.style.color = "var(--unique)";
                else el.style.color = "#fff";
            }
        }
    }

    window.onload = init;
</script>
</body>
</html>