<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>VILLAIN HUNTER : ULTIMATE</title>
    <style>
        :root { --bg: #0c0c0c; --panel: #1a1a1a; --text: #eee; --rare: #00f2ff; --unique: #bf00ff; --gold: #ffd700; --danger: #ff4444; }
        body { background: var(--bg); color: var(--text); font-family: sans-serif; display: flex; justify-content: center; padding: 20px; margin: 0; }
        #game-container { width: 480px; background: var(--panel); border-radius: 20px; padding: 25px; border: 1px solid #333; position: relative; }
        .equip-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 6px; margin-bottom: 15px; }
        .slot { background: #000; border: 1px solid #333; padding: 5px; border-radius: 8px; text-align: center; height: 55px; font-size: 10px; display: flex; flex-direction: column; justify-content: center; }
        .rare { border-color: var(--rare); color: var(--rare); }
        .unique { border-color: var(--unique); color: var(--unique); }
        .hp-bar { width: 100%; height: 14px; background: #222; border-radius: 7px; overflow: hidden; position: relative; margin: 5px 0; }
        .hp-fill { height: 100%; transition: width 0.3s; }
        #log-window { height: 120px; overflow-y: auto; font-size: 11px; color: #888; background: #000; padding: 10px; border-radius: 10px; margin-top: 10px; border: 1px solid #222; }
        button { background: var(--danger); color: #fff; border: none; padding: 12px; border-radius: 8px; width: 100%; font-weight: bold; cursor: pointer; margin-top: 5px; }
        .modal { display: none; position: absolute; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.95); z-index:100; flex-direction:column; align-items:center; justify-content:center; border-radius:20px; }
    </style>
</head>
<body>
<div id="game-container">
    <div id="game-over" class="modal">
        <h1 style="color:var(--danger);">MENTAL BREAK</h1>
        <p id="death-reason" style="padding:20px;"></p>
        <button onclick="location.reload()" style="width:200px;">ì¬ë„ì „</button>
    </div>
    <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
        <div><div id="stage-text" style="color:var(--rare); font-size:12px;">STAGE 1</div><div style="font-size:20px; font-weight:900; color:var(--gold);">COLLECT <span id="col-count">0</span>/50</div></div>
        <div style="text-align:right;">Lv.<span id="p-lv">1</span><br><span id="p-atk-text" style="font-size:10px;">ATK: 10</span></div>
    </div>
    <div class="equip-grid" id="equip-ui">
        <div class="slot" id="slot-weapon"><span>ë¬´ê¸°</span><div class="name">-</div></div>
        <div class="slot" id="slot-hat"><span>ëª¨ì</span><div class="name">-</div></div>
        <div class="slot" id="slot-top"><span>ìƒì˜</span><div class="name">-</div></div>
        <div class="slot" id="slot-bottom"><span>í•˜ì˜</span><div class="name">-</div></div>
        <div class="slot" id="slot-glove"><span>ì¥ê°‘</span><div class="name">-</div></div>
        <div class="slot" id="slot-neck"><span>ëª©ê±¸ì´</span><div class="name">-</div></div>
        <div class="slot" id="slot-wrist"><span>ì†ëª©</span><div class="name">-</div></div>
        <div class="slot" style="border-color:var(--gold);"><span>í”¼ì</span><div id="pot-count">2</div></div>
    </div>
    <div style="background:#000; padding:15px; border-radius:15px; border:1px solid #333; margin-bottom:10px; text-align:center;">
        <div id="m-name" style="font-weight:bold;">ë¹ŒëŸ° ì¶œí˜„ ëŒ€ê¸°...</div>
        <div id="m-skill" style="color:var(--danger); font-size:11px;">-</div>
        <div class="hp-bar"><div id="m-hp-fill" class="hp-fill" style="background:var(--danger); width:100%;"></div></div>
    </div>
    <div style="padding:10px; background:rgba(255,255,255,0.02); border-radius:10px;">
        <div style="display:flex; justify-content:space-between; font-size:11px;"><span>ë‚´ ë©˜íƒˆ</span><span id="p-hp-text">100/100</span></div>
        <div class="hp-bar"><div id="p-hp-fill" class="hp-fill" style="background:#fff; width:100%;"></div></div>
        <button onclick="usePotion()">ğŸ• í”¼ì ë¨¹ê¸°</button>
    </div>
    <div id="log-window"></div>
</div>
<script src="villains.js"></script>
<script src="items.js"></script>
<script>
    let p = { lv:1, hp:100, atk:10, pot:2, stage:0, book:{}, eq:{} };
    let m = null;
    const init = () => { spawn(); setInterval(tick, 1000); updateUI(); };
    const getAtk = () => p.atk + Object.values(p.eq).reduce((a,b)=> (b.slot==='weapon'||b.slot==='glove')?a+b.val:a, 0);
    const getMaxHP = () => 100 + (p.lv*10) + Object.values(p.eq).reduce((a,b)=> (['top','bottom','hat','wrist'].includes(b.slot))?a+b.val:a, 0);
    const spawn = () => {
        const raw = VILLAINS_DATA[p.stage][Math.floor(Math.random()*10)];
        const g = 1+(p.lv*0.15);
        m = { ...raw, curHp: Math.floor(raw.hp*g), maxHp: Math.floor(raw.hp*g), curAtk: Math.floor(raw.atk*g) };
        updateUI();
    };
    const tick = () => {
        if(p.hp <= 0) return;
        m.curHp -= getAtk();
        if(m.curHp <= 0) { win(); return; }
        p.hp -= m.curAtk;
        addLog(`ğŸ’¢ ${m.name}: -${m.curAtk}`);
        if(p.hp <= 0) { 
            document.getElementById('death-reason').innerText = `${m.name}: "${m.killMsg}"`;
            document.getElementById('game-over').style.display = 'flex'; 
        }
        updateUI();
    };
    const win = () => {
        addLog(`âœ¨ ${m.name} ê·¹ë³µ!`);
        p.book[m.name] = true; p.lv++; p.atk += 2;
        const drop = ITEM_SYSTEM.generateDrop(m, p.stage);
        if(drop && (!p.eq[drop.slot] || p.eq[drop.slot].val < drop.val)) {
            p.eq[drop.slot] = drop;
            addLog(`ğŸ [${drop.grade.toUpperCase()}] ${drop.name} ì¥ì°©!`);
        }
        if(Math.random()<0.5) p.pot++;
        if(VILLAINS_DATA[p.stage].every(v=>p.book[v.name]) && p.stage < 4) p.stage++;
        spawn();
    };
    const usePotion = () => {
        if(p.pot<=0) return;
        p.pot--; p.hp = Math.min(getMaxHP(), p.hp + Math.floor(getMaxHP()*0.5));
        addLog(`ğŸ• í”¼ì íšŒë³µ!`); updateUI();
    };
    const addLog = (msg) => {
        const log = document.getElementById('log-window');
        const d = document.createElement('div'); d.innerHTML = msg;
        log.insertBefore(d, log.firstChild);
        if(log.childNodes.length > 20) log.lastChild.remove();
    };
    const updateUI = () => {
        const max = getMaxHP();
        document.getElementById('p-lv').innerText = p.lv;
        document.getElementById('p-atk-text').innerText = `ATK: ${getAtk()}`;
        document.getElementById('p-hp-text').innerText = `${Math.max(0,p.hp)}/${max}`;
        document.getElementById('p-hp-fill').style.width = (p.hp/max*100) + "%";
        document.getElementById('m-name').innerText = m.name;
        document.getElementById('m-skill').innerText = `ê¸°ìˆ : ${m.skill}`;
        document.getElementById('m-hp-fill').style.width = (m.curHp/m.maxHp*100) + "%";
        document.getElementById('col-count').innerText = Object.keys(p.book).length;
        document.getElementById('pot-count').innerText = p.pot;
        ITEM_SYSTEM.slots.forEach(s => {
            const el = document.getElementById(`slot-${s}`);
            if(p.eq[s]) { el.querySelector('.name').innerText = p.eq[s].name; el.className = `slot ${p.eq[s].grade}`; }
        });
    };
    window.onload = init;
</script>
</body>
</html>